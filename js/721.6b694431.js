"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[721],{4318:function(){},9752:function(e,a,t){t.d(a,{A:function(){return y}});var i=t(6768),n=t(4232);const s={id:"themeMask"},o=["cx","cy","r"],l=["r"],c=["opacity"];function d(e,a,t,d,r,u){return(0,i.uX)(),(0,i.CE)("div",{id:"themeToggle",onClick:a[0]||(a[0]=(...e)=>u.handleToggleClick&&u.handleToggleClick(...e))},[((0,i.uX)(),(0,i.CE)("svg",{class:(0,n.C4)(["theme_toggle_svg",{dark:r.isDark}]),width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",stroke:"currentColor"},[(0,i.Lk)("mask",s,[a[1]||(a[1]=(0,i.Lk)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"},null,-1)),(0,i.Lk)("circle",{class:"theme_toggle_circle1",fill:"black",cx:r.isDark?"50%":"100%",cy:r.isDark?"23%":"0%",r:r.isDark?"9":"5"},null,8,o)]),(0,i.Lk)("circle",{class:"theme_toggle_circle2",cx:"12",cy:"12",r:r.isDark?"9":"5",mask:"url(#themeMask)"},null,8,l),(0,i.Lk)("g",{class:"theme_toggle_g",stroke:"currentColor",opacity:r.isDark?0:1},a[2]||(a[2]=[(0,i.Fv)('<line x1="12" y1="1" x2="12" y2="3" data-v-4c88bff4></line><line x1="12" y1="21" x2="12" y2="23" data-v-4c88bff4></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-v-4c88bff4></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-v-4c88bff4></line><line x1="1" y1="12" x2="3" y2="12" data-v-4c88bff4></line><line x1="21" y1="12" x2="23" y2="12" data-v-4c88bff4></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-v-4c88bff4></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-v-4c88bff4></line>',8)]),8,c)],2))])}var r={name:"ToggleDark",data(){return{isDark:this.$store.getters.useDarkMode}},methods:{handleToggleClick(){this.isDark=!this.isDark,this.$store.commit("setUseDarkMode",this.isDark),this.$store.commit("setCusDarkMode",!0)}}},u=t(1241);const h=(0,u.A)(r,[["render",d],["__scopeId","data-v-4c88bff4"]]);var m=h,p=t(9017);t(5331),t(6055),t(8830),t(3597);const g={class:"tabs"},f={class:"title"},b={class:"tabs-dropdown-link"};function k(e,a,t,s,o,l){const c=(0,i.g2)("font-awesome-icon"),d=p.c6,r=p.Iy,u=p.dW,h=m;return(0,i.uX)(),(0,i.CE)("div",g,[(0,i.Lk)("div",{class:"title-container",onClick:a[0]||(a[0]=(...e)=>l.refreshDashboard&&l.refreshDashboard(...e))},[(0,i.bF)(c,{icon:l.iconName,class:"title-icon"},null,8,["icon"]),(0,i.Lk)("span",f,(0,n.v_)(l.titleName),1)]),(0,i.bF)(u,{onCommand:l.handleTabClick,class:"tabs-dropdown",role:"navigation",onVisibleChange:l.handleDropdownVisible,"popper-class":"tabs-dropdown-popper",trigger:"click"},{dropdown:(0,i.k6)((()=>[(0,i.bF)(r,null,{default:(0,i.k6)((()=>["dashboard"!==t.activeTab?((0,i.uX)(),(0,i.Wv)(d,{key:0,command:"dashboard",class:"dropdown-item"},{default:(0,i.k6)((()=>[(0,i.bF)(c,{icon:"images",class:"dropdown-icon"}),a[2]||(a[2]=(0,i.Lk)("span",null,"Gallery",-1))])),_:1})):(0,i.Q3)("",!0),"customerConfig"!==t.activeTab?((0,i.uX)(),(0,i.Wv)(d,{key:1,command:"customerConfig",class:"dropdown-item"},{default:(0,i.k6)((()=>[(0,i.bF)(c,{icon:"user-cog",class:"dropdown-icon"}),a[3]||(a[3]=(0,i.Lk)("span",null,"用户管理",-1))])),_:1})):(0,i.Q3)("",!0),"systemConfig"!==t.activeTab?((0,i.uX)(),(0,i.Wv)(d,{key:2,command:"systemConfig",class:"dropdown-item"},{default:(0,i.k6)((()=>[(0,i.bF)(c,{icon:"cogs",class:"dropdown-icon"}),a[4]||(a[4]=(0,i.Lk)("span",null,"系统设置",-1))])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(d,{command:"",class:"dropdown-item"},{default:(0,i.k6)((()=>[(0,i.bF)(c,{icon:"upload",class:"dropdown-icon"}),a[5]||(a[5]=(0,i.Lk)("span",null,"上传页面",-1))])),_:1})])),_:1})])),default:(0,i.k6)((()=>[(0,i.Lk)("div",b,[a[1]||(a[1]=(0,i.Lk)("span",{class:"menu-text"},"菜单",-1)),(0,i.bF)(c,{icon:"bars",class:"tabs-arrow"})])])),_:1},8,["onCommand","onVisibleChange"]),(0,i.bF)(h,{class:"toggle-dark"})])}t(4114);var v={name:"DashboardTabs",components:{AdminToggleDark:m},props:{activeTab:{type:String,default:"dashboard"}},computed:{titleName(){const e={dashboard:"Gallery",customerConfig:"用户管理",systemConfig:"系统设置",default:"上传页面"};return e[this.activeTab]||e.default},iconName(){const e={dashboard:"images",customerConfig:"user-cog",systemConfig:"cogs",default:"upload"};return e[this.activeTab]||e.default}},methods:{refreshDashboard(){location.reload()},handleTabClick(e){this.$router.push(`/${e}`)},handleDropdownVisible(e){const a=document.querySelector(".tabs-dropdown-link");e?a.classList.add("active"):a.classList.remove("active")}}};const w=(0,u.A)(v,[["render",k],["__scopeId","data-v-ba482d9c"]]);var y=w},9721:function(e,a,t){t.r(a),t.d(a,{default:function(){return M}});var i=t(9114),n=(t(5331),t(694),t(47)),s=(t(9648),t(7815)),o=(t(5534),t(5558)),l=(t(456),t(6023)),c=(t(8736),t(213),t(5970),t(7009)),d=(t(8450),t(8785),t(4880)),r=(t(7128),t(1450)),u=t(9752),h=t(6768),m=t(4232);const p={class:"container"},g={class:"header-content"},f={class:"header-action"},b={class:"main-container"},k={class:"page-header"},v={class:"page-title"},w={class:"table-container"},y={class:"expanded-content"},C={class:"expanded-header"},L={class:"filename-cell"},F={class:"filename-text"},D={class:"preview-container"},T=["src"],_={key:2,class:"preview-file"},x={class:"timestamp-cell"},S={class:"ip-cell"},$={class:"count-badge"},z={class:"pagination-container"};function A(e,a,t,A,W,E){const X=u.A,P=(0,h.g2)("font-awesome-icon"),M=r.R7,N=d.bZ,I=l.o8,V=c.Zq,U=l.Up,G=o.qi,Q=s.aQ,B=n.S2,j=i.L;return(0,h.uX)(),(0,h.CE)("div",p,[(0,h.bF)(N,null,{default:(0,h.k6)((()=>[(0,h.Lk)("div",g,[(0,h.bF)(X,{activeTab:"customerConfig"}),(0,h.Lk)("div",f,[(0,h.bF)(M,{disabled:E.disableTooltip,content:"退出登录",placement:"bottom","popper-class":"custom-tooltip"},{default:(0,h.k6)((()=>[(0,h.bF)(P,{icon:"sign-out-alt",class:"header-icon",onClick:E.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,h.Lk)("div",b,[(0,h.Lk)("div",k,[(0,h.Lk)("div",v,[(0,h.bF)(P,{icon:"users-cog",class:"title-icon"}),a[0]||(a[0]=(0,h.Lk)("h1",null,"用户管理",-1))]),a[1]||(a[1]=(0,h.Lk)("div",{class:"page-subtitle"},"管理用户上传权限和查看上传历史",-1))]),(0,h.Lk)("div",w,[(0,h.bo)(((0,h.uX)(),(0,h.Wv)(U,{data:E.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed","row-class-name":E.tableRowClassName},{default:(0,h.k6)((()=>[(0,h.bF)(I,{type:"expand"},{default:(0,h.k6)((e=>[(0,h.Lk)("div",y,[(0,h.Lk)("div",C,[(0,h.bF)(P,{icon:"history",class:"expanded-icon"}),a[2]||(a[2]=(0,h.Lk)("h3",null,"上传文件历史",-1))]),(0,h.bF)(U,{data:e.row.data,class:"history-table","default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed","max-height":400},{default:(0,h.k6)((()=>[(0,h.bF)(I,{prop:"metadata.FileName",label:"文件名","min-width":"180"},{default:(0,h.k6)((({row:e})=>[(0,h.Lk)("div",L,[(0,h.bF)(P,{icon:E.getFileIcon(e.metadata?.FileType),class:"file-type-icon"},null,8,["icon"]),(0,h.Lk)("span",F,(0,m.v_)(e.metadata.FileName),1)])])),_:1}),(0,h.bF)(I,{prop:"name",label:"文件预览",width:"120"},{default:(0,h.k6)((({row:e})=>[(0,h.Lk)("div",D,[e.metadata?.FileType?.includes("image")?((0,h.uX)(),(0,h.Wv)(V,{key:0,src:"/file/"+e.name+"?from=admin",fit:"cover",lazy:"",class:"preview-image","preview-src-list":["/file/"+e.name+"?from=admin"]},null,8,["src","preview-src-list"])):e.metadata?.FileType?.includes("video")?((0,h.uX)(),(0,h.CE)("video",{key:1,src:"/file/"+e.name+"?from=admin",controls:"",class:"preview-video"},null,8,T)):((0,h.uX)(),(0,h.CE)("div",_,[(0,h.bF)(P,{icon:E.getFileIcon(e.metadata?.FileType)},null,8,["icon"])]))])])),_:1}),(0,h.bF)(I,{label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":E.sortByTimestamp,width:"180"},{default:(0,h.k6)((({row:e})=>[(0,h.Lk)("div",x,[(0,h.bF)(P,{icon:"clock",class:"time-icon"}),(0,h.Lk)("span",null,(0,m.v_)(E.formatTimeStamp(e.metadata.TimeStamp)),1)])])),_:1},8,["sort-method"])])),_:2},1032,["data"])])])),_:1}),(0,h.bF)(I,{prop:"ip",label:"IP地址","min-width":"150"},{default:(0,h.k6)((({row:e})=>[(0,h.Lk)("div",S,[(0,h.bF)(P,{icon:"network-wired",class:"ip-icon"}),(0,h.Lk)("span",null,(0,m.v_)(e.ip),1)])])),_:1}),(0,h.bF)(I,{prop:"count",label:"上传次数",sortable:"",width:"120"},{default:(0,h.k6)((({row:e})=>[(0,h.Lk)("div",$,(0,m.v_)(e.count),1)])),_:1}),(0,h.bF)(I,{label:"上传权限",width:"150"},{default:(0,h.k6)((({row:e})=>[(0,h.bF)(G,{modelValue:e.enable,"onUpdate:modelValue":a=>e.enable=a,"active-color":"#ff9cad","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:a=>E.handleSwitchEnable(e),class:"permission-switch"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data","row-class-name"])),[[j,W.loading]])]),(0,h.Lk)("div",z,[(0,h.bF)(Q,{background:"",layout:"prev, pager, next",total:W.dealedData.length,"current-page":W.currentPage,"page-size":W.pageSize,onCurrentChange:E.handlePageChange,class:"custom-pagination"},null,8,["total","current-page","page-size","onCurrentChange"]),W.currentPage===Math.ceil(W.dealedData.length/W.pageSize)?((0,h.uX)(),(0,h.Wv)(B,{key:0,type:"primary",onClick:E.loadMoreData,loading:W.loading,class:"load-more-button"},{default:(0,h.k6)((()=>[(0,h.bF)(P,{icon:"sync-alt",class:"button-icon"}),a[3]||(a[3]=(0,h.Lk)("span",null,"加载更多",-1))])),_:1},8,["onClick","loading"])):(0,h.Q3)("",!0)])])])}t(4114);var W=t(782),E={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:u.A},computed:{...(0,W.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768},paginatedData(){const e=(this.currentPage-1)*this.pageSize,a=e+this.pageSize;return this.dealedData.slice(e,a)}},methods:{getFileIcon(e){return e?e.includes("image")?"file-image":e.includes("video")?"file-video":e.includes("audio")?"file-audio":e.includes("pdf")?"file-pdf":e.includes("word")||e.includes("document")?"file-word":e.includes("excel")||e.includes("spreadsheet")?"file-excel":e.includes("powerpoint")||e.includes("presentation")?"file-powerpoint":e.includes("zip")||e.includes("archive")?"file-archive":e.includes("code")||e.includes("text")?"file-code":"file":"file"},tableRowClassName({row:e}){return e.enable?"":"blocked-row"},async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){const a=new Date(e);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(a)},sortByTimestamp(e,a){return new Date(e.metadata.TimeStamp)-new Date(a.metadata.TimeStamp)},async handleSwitchEnable(e){const a=e.ip,t=e.enable;try{t?(this.blockipList=this.blockipList.filter((e=>e!==a)),await this.fetchWithAuth("/api/manage/cusConfig/whiteip",{method:"POST",body:a}),this.$message({message:`已允许 ${a} 上传文件`,type:"success",icon:'<i class="fas fa-check-circle"></i>'})):(this.blockipList.push(a),await this.fetchWithAuth("/api/manage/cusConfig/blockip",{method:"POST",body:a}),this.$message({message:`已禁止 ${a} 上传文件`,type:"warning",icon:'<i class="fas fa-ban"></i>'}))}catch(i){this.$message.error("操作失败，请重试"),e.enable=!t}},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},async loadMoreData(){this.loading=!0;try{const e=this.dealedData.length,a=20,t=await this.fetchWithAuth(`/api/manage/cusConfig/list?start=${e}&count=${a}`,{method:"GET"}),i=await t.json();if(0===i.length)return void this.$message({message:"已加载全部数据",type:"info",icon:'<i class="fas fa-info-circle"></i>'});this.dealedData=this.dealedData.concat(i.map((e=>{const a=!this.blockipList.includes(e.ip);return{ip:e.ip,count:e.count,data:e.data,enable:a}}))),this.$message({message:`成功加载 ${i.length} 条新数据`,type:"success",icon:'<i class="fas fa-check-circle"></i>'})}catch(e){this.$message.error("加载更多数据时出错，请检查网络连接")}finally{this.loading=!1}},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},async mounted(){this.loading=!0;try{const e=await this.fetchWithAuth("/api/manage/check",{method:"GET"}),a=await e.text();if("true"!=a&&"Not using basic auth."!=a)throw new Error("Unauthorized");{const e=await this.fetchWithAuth("/api/manage/cusConfig/list?count=20",{method:"GET"}),a=await e.json(),t=await this.fetchWithAuth("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await t.text()).split(","),this.dealedData=a.map((e=>{const a=!this.blockipList.includes(e.ip);return{ip:e.ip,count:e.count,data:e.data,enable:a}}))}}catch(e){"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}finally{this.loading=!1}}},X=t(1241);const P=(0,X.A)(E,[["render",A],["__scopeId","data-v-23426311"]]);var M=P},8050:function(e,a,t){t(5331)},8736:function(e,a,t){t(5331)},3597:function(e,a,t){t(5331)},8830:function(e,a,t){t(5331)},6055:function(e,a,t){t(5331),t(9648),t(8050),t(9104),t(5970)},7128:function(e,a,t){t(5331),t(4318)},8450:function(e,a,t){t(5331)},694:function(e,a,t){t(5331)},5534:function(e,a,t){t(5331),t(8785),t(5970),t(9104)},9104:function(e,a,t){t(5331)},5970:function(e,a,t){t(5331)},456:function(e,a,t){t(5331)},8785:function(e,a,t){t(5331)},213:function(e,a,t){t(5331),t(9104)}}]);
//# sourceMappingURL=721.6b694431.js.map
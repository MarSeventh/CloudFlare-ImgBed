"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[601],{694:function(e,a,t){t(5331)},2907:function(e,a,t){t(5331),t(6808),t(6711)},4752:function(e,a,t){t(5331),t(8736),t(8785)},5802:function(e,a,t){t(5331),t(8736),t(213),t(5970)},9601:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});var i=t(9114),n=(t(5331),t(694),t(47)),o=(t(9648),t(7815)),l=(t(2907),t(5558)),s=(t(8075),t(7138)),d=(t(5802),t(7009)),r=(t(8450),t(4752),t(4880)),c=(t(7128),t(8507)),u=(t(213),t(6011)),h=t(6768),p=t(4232);const m={class:"container"},g={class:"header-content"},b={class:"header-action"},f={class:"main-container"},k={style:{margin:"8px"}},y=["src"],C={key:2,style:{width:"100px",height:"100px",display:"flex","justify-content":"center","align-items":"center"}},w={class:"pagination-container"};function v(e,a,t,v,T,S){const x=u.A,D=(0,h.g2)("font-awesome-icon"),F=c.R7,L=r.bZ,z=s.o8,_=d.Zq,A=s.Up,E=l.qi,P=o.aQ,W=n.S2,X=i.A;return(0,h.uX)(),(0,h.CE)("div",m,[(0,h.bF)(L,null,{default:(0,h.k6)(()=>[(0,h.Lk)("div",g,[(0,h.bF)(x,{activeTab:"customerConfig"}),(0,h.Lk)("div",b,[(0,h.bF)(F,{disabled:S.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,h.k6)(()=>[(0,h.bF)(D,{icon:"sign-out-alt",class:"header-icon",onClick:S.handleLogout},null,8,["onClick"])]),_:1},8,["disabled"])])])]),_:1}),(0,h.Lk)("div",f,[(0,h.bo)(((0,h.uX)(),(0,h.Wv)(A,{data:S.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,h.k6)(()=>[(0,h.bF)(z,{type:"expand"},{default:(0,h.k6)(e=>[(0,h.Lk)("div",k,[a[0]||(a[0]=(0,h.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,h.bF)(A,{data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed","max-height":400},{default:(0,h.k6)(()=>[(0,h.bF)(z,{prop:"metadata.FileName",label:"文件名"}),(0,h.bF)(z,{label:"文件预览"},{default:(0,h.k6)(({row:e})=>[e.metadata?.FileType?.includes("image")?((0,h.uX)(),(0,h.Wv)(_,{key:0,src:"/file/"+e.id+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):e.metadata?.FileType?.includes("video")?((0,h.uX)(),(0,h.CE)("video",{key:1,src:"/file/"+e.id+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,y)):((0,h.uX)(),(0,h.CE)("div",C,[(0,h.bF)(D,{icon:"file",style:{"font-size":"2em"}})]))]),_:1}),(0,h.bF)(z,{formatter:S.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":S.sortByTimestamp},{default:(0,h.k6)(({row:e})=>[(0,h.eW)((0,p.v_)(S.formatTimeStamp(e.metadata.TimeStamp)),1)]),_:1},8,["formatter","sort-method"])]),_:1},8,["data"])])]),_:1}),(0,h.bF)(z,{prop:"ip",label:"IP地址"}),(0,h.bF)(z,{prop:"address",label:"地址"}),(0,h.bF)(z,{prop:"count",label:"上传次数",sortable:""}),(0,h.bF)(z,{label:"允许上传"},{default:(0,h.k6)(({row:e})=>[(0,h.bF)(E,{modelValue:e.enable,"onUpdate:modelValue":a=>e.enable=a,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:a=>S.handleSwitchEnable(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])),[[X,T.loading]]),(0,h.Lk)("div",w,[(0,h.bF)(P,{background:"",layout:"prev, pager, next",total:T.dealedData.length,"current-page":T.currentPage,"page-size":T.pageSize,"pager-count":S.pagerCount,onCurrentChange:S.handlePageChange},null,8,["total","current-page","page-size","pager-count","onCurrentChange"]),T.currentPage===Math.ceil(T.dealedData.length/T.pageSize)?((0,h.uX)(),(0,h.Wv)(W,{key:0,type:"primary",onClick:S.loadMoreData,loading:T.loading,class:"load-more"},{default:(0,h.k6)(()=>[...a[1]||(a[1]=[(0,h.eW)("加载更多",-1)])]),_:1},8,["onClick","loading"])):(0,h.Q3)("",!0)])])])}t(4114),t(8111),t(2489),t(1701);var T=t(797),S=t(8903),x={name:"CustomerConfig",mixins:[S.A],data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:u.A},computed:{disableTooltip(){return window.innerWidth<768},pagerCount(){return window.innerWidth<768?3:7},paginatedData(){const e=(this.currentPage-1)*this.pageSize,a=e+this.pageSize;return this.dealedData.slice(e,a)}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,a){return new Date(e.metadata.TimeStamp)-new Date(a.metadata.TimeStamp)},async handleSwitchEnable(e){const a=e.ip,t=e.enable;t?(this.blockipList=this.blockipList.filter(e=>e!==a),await(0,T.A)("/api/manage/cusConfig/whiteip",{method:"POST",body:a})):(this.blockipList.push(a),await(0,T.A)("/api/manage/cusConfig/blockip",{method:"POST",body:a}))},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},loadMoreData(){this.loading=!0;const e=this.dealedData.length,a=20;(0,T.A)(`/api/manage/cusConfig/list?start=${e}&count=${a}`,{method:"GET"}).then(e=>e.json()).then(e=>{this.dealedData=this.dealedData.concat(e.map(e=>{const a=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:a}}))}).catch(()=>{this.$message.error("加载更多数据时出错，请检查网络连接")}).finally(()=>{this.loading=!1})},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},mounted(){this.initializeBackground("adminBkImg",".container",!1,!0),this.loading=!0,(0,T.A)("/api/manage/check",{method:"GET"}).then(e=>e.text()).then(e=>{if("true"==e)return this.showLogoutButton=!0,(0,T.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});if("Not using basic auth."==e)return(0,T.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});throw new Error("Unauthorized")}).then(e=>e.json()).then(async e=>{const a=await(0,T.A)("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await a.text()).split(","),this.dealedData=e.map(e=>{const a=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:a}})}).catch(e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}).finally(()=>{this.loading=!1})}},D=t(1241);const F=(0,D.A)(x,[["render",v],["__scopeId","data-v-37d3195f"]]);var L=F}}]);
//# sourceMappingURL=601.87ef6cd3.js.map
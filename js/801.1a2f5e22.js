"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[801],{2801:function(e,i,t){t.r(i),t.d(i,{default:function(){return U}});var r=t(6768),s=t(4232),l=t(5130);const o={class:"public-browse"},a={class:"header"},n={class:"header-center"},c={class:"breadcrumb"},d=["onClick"],h={class:"header-right"},u={class:"file-count"},p={key:0,class:"loading-container"},v={key:1,class:"error-container"},m={key:2,class:"gallery-container"},g={class:"gallery-grid"},k=["onClick"],w=["onClick"],C={class:"folder-name"},f={class:"image-wrapper"},y=["src","alt"],b=["src"],F={key:2,class:"file-placeholder"},L={class:"overlay"},I={class:"overlay-actions"},P=["onClick"],E=["onClick"],X={class:"item-info"},x={class:"item-name"},$={key:0,class:"load-more"},D=["disabled"],M=["src"],V=["src"];function R(e,i,t,R,_,z){return(0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("header",a,[i[12]||(i[12]=(0,r.Lk)("div",{class:"header-left"},[(0,r.Lk)("span",{class:"logo"},"公开相册")],-1)),(0,r.Lk)("div",n,[(0,r.Lk)("div",c,[(0,r.Lk)("span",{class:"breadcrumb-item",onClick:i[0]||(i[0]=(...e)=>z.goToRoot&&z.goToRoot(...e))},(0,s.v_)(z.rootDirName),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(z.pathParts,(e,t)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t},[i[11]||(i[11]=(0,r.Lk)("span",{class:"breadcrumb-sep"},"/",-1)),(0,r.Lk)("span",{class:"breadcrumb-item",onClick:e=>z.goToPath(t)},(0,s.v_)(e),9,d)],64))),128))])]),(0,r.Lk)("div",h,[(0,r.Lk)("span",u,(0,s.v_)(_.totalCount)+" 个文件",1)])]),_.loading&&0===_.files.length?((0,r.uX)(),(0,r.CE)("div",p,[...i[13]||(i[13]=[(0,r.Lk)("div",{class:"loading-spinner"},null,-1),(0,r.Lk)("p",null,"加载中...",-1)])])):_.error?((0,r.uX)(),(0,r.CE)("div",v,[(0,r.Lk)("p",null,(0,s.v_)(_.error),1),_.canRetry?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:i[1]||(i[1]=(...e)=>z.loadFiles&&z.loadFiles(...e)),class:"retry-btn"},"重试")):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",m,[(0,r.Lk)("div",g,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.files,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:e.name,class:"gallery-item",onClick:e=>z.openPreview(t)},[e.isFolder?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"folder-card",onClick:(0,l.D$)(i=>z.enterFolder(e.name),["stop"])},[i[14]||(i[14]=(0,r.Lk)("div",{class:"folder-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})])],-1)),(0,r.Lk)("span",C,(0,s.v_)(z.getFolderName(e.name)),1)],8,w)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",f,[z.isImage(e)?((0,r.uX)(),(0,r.CE)("img",{key:0,src:z.getFileUrl(e.name),alt:e.name,loading:"lazy",onError:i[2]||(i[2]=(...e)=>z.handleImageError&&z.handleImageError(...e))},null,40,y)):z.isVideo(e)?((0,r.uX)(),(0,r.CE)("video",{key:1,src:z.getFileUrl(e.name),muted:"",loop:"",onMouseenter:i[3]||(i[3]=e=>e.target.play()),onMouseleave:i[4]||(i[4]=e=>e.target.pause())},null,40,b)):((0,r.uX)(),(0,r.CE)("div",F,[...i[15]||(i[15]=[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z"})],-1)])])),(0,r.Lk)("div",L,[(0,r.Lk)("div",I,[(0,r.Lk)("button",{class:"action-btn",onClick:(0,l.D$)(i=>z.copyLink(e.name),["stop"]),title:"复制链接"},[...i[16]||(i[16]=[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"})],-1)])],8,P),(0,r.Lk)("button",{class:"action-btn",onClick:(0,l.D$)(i=>z.downloadFile(e.name),["stop"]),title:"下载"},[...i[17]||(i[17]=[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})],-1)])],8,E)])])]),(0,r.Lk)("div",X,[(0,r.Lk)("span",x,(0,s.v_)(z.getFileName(e.name)),1)])],64))],8,k))),128))]),_.hasMore?((0,r.uX)(),(0,r.CE)("div",$,[(0,r.Lk)("button",{onClick:i[5]||(i[5]=(...e)=>z.loadMore&&z.loadMore(...e)),disabled:_.loading,class:"load-more-btn"},(0,s.v_)(_.loading?"加载中...":"加载更多"),9,D)])):(0,r.Q3)("",!0)])),_.previewVisible?((0,r.uX)(),(0,r.CE)("div",{key:3,class:"preview-modal",onClick:i[10]||(i[10]=(...e)=>z.closePreview&&z.closePreview(...e))},[(0,r.Lk)("div",{class:"preview-content",onClick:i[9]||(i[9]=(0,l.D$)(()=>{},["stop"]))},[(0,r.Lk)("button",{class:"preview-close",onClick:i[6]||(i[6]=(...e)=>z.closePreview&&z.closePreview(...e))},"×"),_.previewIndex>0?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"preview-prev",onClick:i[7]||(i[7]=(...e)=>z.prevImage&&z.prevImage(...e))},"<")):(0,r.Q3)("",!0),z.currentPreviewFile&&z.isImage(z.currentPreviewFile)?((0,r.uX)(),(0,r.CE)("img",{key:1,src:z.getFileUrl(z.currentPreviewFile.name),class:"preview-image"},null,8,M)):z.currentPreviewFile&&z.isVideo(z.currentPreviewFile)?((0,r.uX)(),(0,r.CE)("video",{key:2,src:z.getFileUrl(z.currentPreviewFile.name),controls:"",autoplay:"",class:"preview-video"},null,8,V)):(0,r.Q3)("",!0),_.previewIndex<z.mediaFiles.length-1?((0,r.uX)(),(0,r.CE)("button",{key:3,class:"preview-next",onClick:i[8]||(i[8]=(...e)=>z.nextImage&&z.nextImage(...e))},">")):(0,r.Q3)("",!0)])])):(0,r.Q3)("",!0)])}t(4114),t(8111),t(2489),t(1701);var _=t(4373),z={name:"PublicBrowse",data(){return{files:[],allowedDirs:[],rootDir:"",currentPath:"",totalCount:0,loading:!1,error:null,canRetry:!0,hasMore:!0,previewVisible:!1,previewIndex:0}},computed:{rootDirName(){return this.rootDir.split("/").filter(Boolean).pop()||"根目录"},pathParts(){if(!this.currentPath||!this.rootDir)return[];const e=this.currentPath.replace(this.rootDir,"").replace(/^\/+/,"");return e.split("/").filter(Boolean)},mediaFiles(){return this.files.filter(e=>!e.isFolder&&(this.isImage(e)||this.isVideo(e)))},currentPreviewFile(){return this.mediaFiles[this.previewIndex]}},watch:{"$route.params.dir":{handler(){this.initFromRoute()}}},mounted(){this.initFromRoute()},methods:{async initFromRoute(){const e=this.$route.params.dir||"",i=Array.isArray(e)?e.join("/"):e;if(!i)return this.error="请指定要浏览的目录，例如: /browse/landscape",void(this.canRetry=!1);const t=i.split("/").filter(Boolean);this.rootDir=t[0],this.currentPath=i,await this.loadFiles()},async loadFiles(){this.loading=!0,this.error=null,this.canRetry=!0;try{const e=await _.A.get(`/api/public/list?dir=${encodeURIComponent(this.currentPath)}&count=50`);e.data.allowedDirs&&(this.allowedDirs=e.data.allowedDirs);const i=(e.data.directories||[]).map(e=>({name:e,isFolder:!0})),t=(e.data.files||[]).map(e=>({name:e.name,isFolder:!1,metadata:e.metadata}));this.files=[...i,...t],this.totalCount=e.data.totalCount||this.files.length,this.hasMore=this.files.filter(e=>!e.isFolder).length<this.totalCount}catch(e){if(403===e.response?.status){const i=e.response?.data?.error||"";i.includes("disabled")?this.error="公开浏览功能未启用":i.includes("not allowed")||i.includes("No public")?this.error="该目录不允许公开访问":this.error="访问被拒绝",this.canRetry=!1}else this.error="加载失败，请重试"}finally{this.loading=!1}},async loadMore(){if(!this.loading){this.loading=!0;try{const e=this.files.filter(e=>!e.isFolder).length,i=await _.A.get(`/api/public/list?dir=${encodeURIComponent(this.currentPath)}&start=${e}&count=50`),t=(i.data.files||[]).map(e=>({name:e.name,isFolder:!1,metadata:e.metadata}));this.files.push(...t),this.hasMore=this.files.filter(e=>!e.isFolder).length<this.totalCount}catch(e){alert("加载更多失败")}finally{this.loading=!1}}},enterFolder(e){const i=e.replace(/\/+$/,"");this.$router.push(`/browse/${i}`)},goToRoot(){this.$router.push(`/browse/${this.rootDir}`)},goToPath(e){const i=this.pathParts.slice(0,e+1),t=this.rootDir+(i.length?"/"+i.join("/"):"");this.$router.push(`/browse/${t}`)},getFolderName(e){return e.split("/").filter(Boolean).pop()||e},getFileName(e){const i=e.split("/").pop();return i.length>20?i.slice(0,17)+"...":i},getFileUrl(e){return`${window.location.origin}/file/${e}`},isImage(e){const i=e.name.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp","bmp","svg"].includes(i)},isVideo(e){const i=e.name.split(".").pop().toLowerCase();return["mp4","webm","ogg","mov"].includes(i)},handleImageError(e){e.target.style.display="none"},copyLink(e){const i=this.getFileUrl(e);navigator.clipboard?.writeText(i).then(()=>{alert("链接已复制")}).catch(()=>{prompt("复制链接:",i)})},downloadFile(e){const i=document.createElement("a");i.href=this.getFileUrl(e),i.download=e.split("/").pop(),i.click()},openPreview(e){const i=this.files[e];if(i.isFolder)return;const t=this.mediaFiles.findIndex(e=>e.name===i.name);t>=0&&(this.previewIndex=t,this.previewVisible=!0,document.body.style.overflow="hidden")},closePreview(){this.previewVisible=!1,document.body.style.overflow=""},prevImage(){this.previewIndex>0&&this.previewIndex--},nextImage(){this.previewIndex<this.mediaFiles.length-1&&this.previewIndex++}}},B=t(1241);const H=(0,B.A)(z,[["render",R],["__scopeId","data-v-7f3b198a"]]);var U=H}}]);
//# sourceMappingURL=801.1a2f5e22.js.map
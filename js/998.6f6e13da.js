"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[998],{1998:function(e,i,l){l.r(i),l.d(i,{default:function(){return N}});var t=l(6768),s=l(4232),a=l(5130);const r={class:"public-browse"},o={class:"header"},n={class:"header-center"},c={class:"folder-tabs"},d=["onClick"],h={class:"header-right"},p={class:"file-count"},u={key:0,class:"loading-container"},v={key:1,class:"error-container"},g={key:2,class:"gallery-container"},m={class:"gallery-grid"},k=["onClick"],w=["onClick"],f={class:"folder-name"},C={class:"image-wrapper"},y=["src","alt"],L=["src"],b={key:2,class:"file-placeholder"},F={class:"overlay"},I={class:"overlay-actions"},E=["onClick"],x=["onClick"],D={class:"item-info"},X={class:"item-name"},M={key:0,class:"load-more"},P=["disabled"],V=["src"],$=["src"];function _(e,i,l,_,z,H){return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.Lk)("header",o,[i[10]||(i[10]=(0,t.Lk)("div",{class:"header-left"},[(0,t.Lk)("span",{class:"logo"},"公开相册")],-1)),(0,t.Lk)("div",n,[(0,t.Lk)("div",c,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(z.allowedDirs,e=>((0,t.uX)(),(0,t.CE)("span",{key:e,class:(0,s.C4)(["folder-tab",{active:z.currentDir===e}]),onClick:i=>H.switchDir(e)},(0,s.v_)(H.formatDirName(e)),11,d))),128))])]),(0,t.Lk)("div",h,[(0,t.Lk)("span",p,(0,s.v_)(z.totalCount)+" 张图片",1)])]),z.loading&&0===z.files.length?((0,t.uX)(),(0,t.CE)("div",u,[...i[11]||(i[11]=[(0,t.Lk)("div",{class:"loading-spinner"},null,-1),(0,t.Lk)("p",null,"加载中...",-1)])])):z.error?((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("p",null,(0,s.v_)(z.error),1),(0,t.Lk)("button",{onClick:i[0]||(i[0]=(...e)=>H.loadFiles&&H.loadFiles(...e)),class:"retry-btn"},"重试")])):((0,t.uX)(),(0,t.CE)("div",g,[(0,t.Lk)("div",m,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(z.files,(e,l)=>((0,t.uX)(),(0,t.CE)("div",{key:e.name,class:"gallery-item",onClick:e=>H.openPreview(l)},[e.isFolder?((0,t.uX)(),(0,t.CE)("div",{key:0,class:"folder-card",onClick:(0,a.D$)(i=>H.enterFolder(e.name),["stop"])},[i[12]||(i[12]=(0,t.Lk)("div",{class:"folder-icon"},[(0,t.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,t.Lk)("path",{d:"M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"})])],-1)),(0,t.Lk)("span",f,(0,s.v_)(H.getFolderName(e.name)),1)],8,w)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.Lk)("div",C,[H.isImage(e)?((0,t.uX)(),(0,t.CE)("img",{key:0,src:H.getFileUrl(e.name),alt:e.name,loading:"lazy",onError:i[1]||(i[1]=(...e)=>H.handleImageError&&H.handleImageError(...e))},null,40,y)):H.isVideo(e)?((0,t.uX)(),(0,t.CE)("video",{key:1,src:H.getFileUrl(e.name),muted:"",loop:"",onMouseenter:i[2]||(i[2]=e=>e.target.play()),onMouseleave:i[3]||(i[3]=e=>e.target.pause())},null,40,L)):((0,t.uX)(),(0,t.CE)("div",b,[...i[13]||(i[13]=[(0,t.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,t.Lk)("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 7V3.5L18.5 9H13z"})],-1)])])),(0,t.Lk)("div",F,[(0,t.Lk)("div",I,[(0,t.Lk)("button",{class:"action-btn",onClick:(0,a.D$)(i=>H.copyLink(e.name),["stop"]),title:"复制链接"},[...i[14]||(i[14]=[(0,t.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,t.Lk)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"})],-1)])],8,E),(0,t.Lk)("button",{class:"action-btn",onClick:(0,a.D$)(i=>H.downloadFile(e.name),["stop"]),title:"下载"},[...i[15]||(i[15]=[(0,t.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,t.Lk)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})],-1)])],8,x)])])]),(0,t.Lk)("div",D,[(0,t.Lk)("span",X,(0,s.v_)(H.getFileName(e.name)),1)])],64))],8,k))),128))]),z.hasMore?((0,t.uX)(),(0,t.CE)("div",M,[(0,t.Lk)("button",{onClick:i[4]||(i[4]=(...e)=>H.loadMore&&H.loadMore(...e)),disabled:z.loading,class:"load-more-btn"},(0,s.v_)(z.loading?"加载中...":"加载更多"),9,P)])):(0,t.Q3)("",!0)])),z.previewVisible?((0,t.uX)(),(0,t.CE)("div",{key:3,class:"preview-modal",onClick:i[9]||(i[9]=(...e)=>H.closePreview&&H.closePreview(...e))},[(0,t.Lk)("div",{class:"preview-content",onClick:i[8]||(i[8]=(0,a.D$)(()=>{},["stop"]))},[(0,t.Lk)("button",{class:"preview-close",onClick:i[5]||(i[5]=(...e)=>H.closePreview&&H.closePreview(...e))},"×"),z.previewIndex>0?((0,t.uX)(),(0,t.CE)("button",{key:0,class:"preview-prev",onClick:i[6]||(i[6]=(...e)=>H.prevImage&&H.prevImage(...e))},"<")):(0,t.Q3)("",!0),H.isImage(z.files[z.previewIndex])?((0,t.uX)(),(0,t.CE)("img",{key:1,src:H.getFileUrl(z.files[z.previewIndex].name),class:"preview-image"},null,8,V)):H.isVideo(z.files[z.previewIndex])?((0,t.uX)(),(0,t.CE)("video",{key:2,src:H.getFileUrl(z.files[z.previewIndex].name),controls:"",autoplay:"",class:"preview-video"},null,8,$)):(0,t.Q3)("",!0),z.previewIndex<H.imageFiles.length-1?((0,t.uX)(),(0,t.CE)("button",{key:3,class:"preview-next",onClick:i[7]||(i[7]=(...e)=>H.nextImage&&H.nextImage(...e))},">")):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0)])}l(4114),l(8111),l(2489),l(1701);var z=l(4373),H={name:"PublicBrowse",data(){return{files:[],allowedDirs:[],currentDir:"",currentPath:"",totalCount:0,loading:!1,error:null,hasMore:!0,previewVisible:!1,previewIndex:0}},computed:{imageFiles(){return this.files.filter(e=>!e.isFolder&&(this.isImage(e)||this.isVideo(e)))}},mounted(){this.init()},methods:{async init(){await this.fetchConfig(),this.allowedDirs.length>0&&(this.currentDir=this.allowedDirs[0],this.currentPath=this.currentDir,await this.loadFiles())},async fetchConfig(){try{const e=await z.A.get("/api/public/list?dir=");e.data.allowedDirs&&(this.allowedDirs=e.data.allowedDirs.map(e=>e.replace(/^\/+|\/+$/g,"")).filter(Boolean))}catch(e){403===e.response?.status?this.error="公开浏览功能未启用":this.error="获取配置失败"}},async loadFiles(){this.loading=!0,this.error=null;try{const e=await z.A.get(`/api/public/list?dir=${encodeURIComponent(this.currentPath)}&count=50`),i=(e.data.directories||[]).map(e=>({name:e,isFolder:!0})),l=(e.data.files||[]).map(e=>({name:e.name,isFolder:!1,metadata:e.metadata}));this.files=[...i,...l],this.totalCount=e.data.totalCount||this.files.length,this.hasMore=this.files.filter(e=>!e.isFolder).length<this.totalCount}catch(e){403===e.response?.status?this.error="该目录不允许访问":this.error="加载失败，请重试"}finally{this.loading=!1}},async loadMore(){if(!this.loading){this.loading=!0;try{const e=this.files.filter(e=>!e.isFolder).length,i=await z.A.get(`/api/public/list?dir=${encodeURIComponent(this.currentPath)}&start=${e}&count=50`),l=(i.data.files||[]).map(e=>({name:e.name,isFolder:!1,metadata:e.metadata}));this.files.push(...l),this.hasMore=this.files.filter(e=>!e.isFolder).length<this.totalCount}catch(e){alert("加载更多失败")}finally{this.loading=!1}}},switchDir(e){this.currentDir=e,this.currentPath=e,this.files=[],this.loadFiles()},enterFolder(e){this.currentPath=e.replace(/\/+$/,""),this.files=[],this.loadFiles()},formatDirName(e){return e.split("/").pop()||e},getFolderName(e){return e.split("/").filter(Boolean).pop()||e},getFileName(e){const i=e.split("/").pop();return i.length>20?i.slice(0,17)+"...":i},getFileUrl(e){return`${window.location.origin}/file/${e}`},isImage(e){const i=e.name.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp","bmp","svg"].includes(i)},isVideo(e){const i=e.name.split(".").pop().toLowerCase();return["mp4","webm","ogg","mov"].includes(i)},handleImageError(e){e.target.style.display="none"},copyLink(e){const i=this.getFileUrl(e);navigator.clipboard?.writeText(i).then(()=>{alert("链接已复制")}).catch(()=>{prompt("复制链接:",i)})},downloadFile(e){const i=document.createElement("a");i.href=this.getFileUrl(e),i.download=e.split("/").pop(),i.click()},openPreview(e){this.files[e].isFolder||(this.previewIndex=e,this.previewVisible=!0,document.body.style.overflow="hidden")},closePreview(){this.previewVisible=!1,document.body.style.overflow=""},prevImage(){this.previewIndex>0&&this.previewIndex--},nextImage(){this.previewIndex<this.files.length-1&&this.previewIndex++}}},U=l(1241);const B=(0,U.A)(H,[["render",_],["__scopeId","data-v-6232ec4f"]]);var N=B}}]);
//# sourceMappingURL=998.6f6e13da.js.map
"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[79],{4318:function(){},3496:function(e,t,a){a.d(t,{A:function(){return v}});var i=a(6768),o=a(4232);const n={id:"themeMask"},s=["cx","cy","r"],l=["r"],r=["opacity"];function c(e,t,a,c,d,h){return(0,i.uX)(),(0,i.CE)("div",{id:"themeToggle",onClick:t[0]||(t[0]=(...e)=>h.handleToggleClick&&h.handleToggleClick(...e))},[((0,i.uX)(),(0,i.CE)("svg",{class:(0,o.C4)(["theme_toggle_svg",{dark:d.isDark}]),width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",stroke:"currentColor"},[(0,i.Lk)("mask",n,[t[1]||(t[1]=(0,i.Lk)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"},null,-1)),(0,i.Lk)("circle",{class:"theme_toggle_circle1",fill:"black",cx:d.isDark?"50%":"100%",cy:d.isDark?"23%":"0%",r:d.isDark?"9":"5"},null,8,s)]),(0,i.Lk)("circle",{class:"theme_toggle_circle2",cx:"12",cy:"12",r:d.isDark?"9":"5",mask:"url(#themeMask)"},null,8,l),(0,i.Lk)("g",{class:"theme_toggle_g",stroke:"currentColor",opacity:d.isDark?0:1},t[2]||(t[2]=[(0,i.Fv)('<line x1="12" y1="1" x2="12" y2="3" data-v-4c88bff4></line><line x1="12" y1="21" x2="12" y2="23" data-v-4c88bff4></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-v-4c88bff4></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-v-4c88bff4></line><line x1="1" y1="12" x2="3" y2="12" data-v-4c88bff4></line><line x1="21" y1="12" x2="23" y2="12" data-v-4c88bff4></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-v-4c88bff4></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-v-4c88bff4></line>',8)]),8,r)],2))])}var d={name:"ToggleDark",data(){return{isDark:this.$store.getters.useDarkMode}},methods:{handleToggleClick(){this.isDark=!this.isDark,this.$store.commit("setUseDarkMode",this.isDark),this.$store.commit("setCusDarkMode",!0)}}},h=a(1241);const u=(0,h.A)(d,[["render",c],["__scopeId","data-v-4c88bff4"]]);var m=u,b=a(9017);a(5331),a(6055),a(8830),a(3597);const f={class:"tabs"},p={class:"tabs-dropdown-link"};function g(e,t,a,n,s,l){const r=(0,i.g2)("font-awesome-icon"),c=b.c6,d=b.Iy,h=b.dW,u=m;return(0,i.uX)(),(0,i.CE)("div",f,[(0,i.Lk)("span",{class:"title",onClick:t[0]||(t[0]=(...e)=>l.refreshDashboard&&l.refreshDashboard(...e))},[(0,i.bF)(r,{icon:l.iconName,class:"fa-images"},null,8,["icon"]),(0,i.eW)(" "+(0,o.v_)(l.titleName),1)]),(0,i.bF)(h,{onCommand:l.handleTabClick,class:"tabs-dropdown",role:"navigation",onVisibleChange:l.handleDropdownVisible,"popper-class":"tabs-dropdown-popper"},{dropdown:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>["dashboard"!==a.activeTab?((0,i.uX)(),(0,i.Wv)(c,{key:0,command:"dashboard"},{default:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"images",style:{"margin-right":"5px"}}),t[1]||(t[1]=(0,i.eW)(" Gallery "))])),_:1})):(0,i.Q3)("",!0),"customerConfig"!==a.activeTab?((0,i.uX)(),(0,i.Wv)(c,{key:1,command:"customerConfig"},{default:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"user-cog",style:{"margin-right":"5px"}}),t[2]||(t[2]=(0,i.eW)(" 用户管理 "))])),_:1})):(0,i.Q3)("",!0),"systemConfig"!==a.activeTab?((0,i.uX)(),(0,i.Wv)(c,{key:2,command:"systemConfig"},{default:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"cogs",style:{"margin-right":"5px"}}),t[3]||(t[3]=(0,i.eW)(" 系统设置 "))])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(c,{command:""},{default:(0,i.k6)((()=>[(0,i.bF)(r,{icon:"upload",style:{"margin-right":"5px"}}),t[4]||(t[4]=(0,i.eW)(" 上传页面 "))])),_:1})])),_:1})])),default:(0,i.k6)((()=>[(0,i.Lk)("span",p,[(0,i.bF)(r,{icon:"bars",class:"tabs-arrow"})])])),_:1},8,["onCommand","onVisibleChange"]),(0,i.bF)(u)])}a(4114);var k={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},components:{AdminToggleDark:m},computed:{titleName(){return"dashboard"===this.activeTab?"Gallery":"customerConfig"===this.activeTab?"用户管理":"systemConfig"===this.activeTab?"系统设置":"上传页面"},iconName(){return"dashboard"===this.activeTab?"images":"customerConfig"===this.activeTab?"user-cog":"systemConfig"===this.activeTab?"cogs":"upload"}},methods:{refreshDashboard(){location.reload()},handleTabClick(e){this.$router.push(`/${e}`)},handleDropdownVisible(e){const t=document.querySelector(".tabs-dropdown-link");e?t.classList.add("rotate-up"):t.classList.remove("rotate-up")}}};const y=(0,h.A)(k,[["render",g],["__scopeId","data-v-0de0fc64"]]);var v=y},9079:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});var i=a(5558),o=(a(5331),a(456),a(6023)),n=(a(8736),a(213),a(5970),a(7009)),s=(a(8450),a(8785),a(4880)),l=(a(7128),a(1450)),r=a(3496),c=a(6768),d=a(4232);const h={class:"container"},u={class:"header-content"},m={class:"header-action"},b={class:"main-container"},f={style:{margin:"8px"}},p=["src"];function g(e,t,a,g,k,y){const v=r.A,w=(0,c.g2)("font-awesome-icon"),C=l.R7,T=s.bZ,x=o.o8,_=n.Zq,D=o.Up,L=i.qi;return(0,c.uX)(),(0,c.CE)("div",h,[(0,c.bF)(T,null,{default:(0,c.k6)((()=>[(0,c.Lk)("div",u,[(0,c.bF)(v,{activeTab:"customerConfig"}),(0,c.Lk)("div",m,[(0,c.bF)(C,{disabled:y.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,c.k6)((()=>[(0,c.bF)(w,{icon:"sign-out-alt",class:"header-icon",onClick:y.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,c.Lk)("div",b,[(0,c.bF)(D,{data:k.dealedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,c.k6)((()=>[(0,c.bF)(x,{type:"expand"},{default:(0,c.k6)((e=>[(0,c.Lk)("div",f,[t[0]||(t[0]=(0,c.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,c.bF)(D,{data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed"},{default:(0,c.k6)((()=>[(0,c.bF)(x,{prop:"metadata.FileName",label:"文件名"}),(0,c.bF)(x,{prop:"name",label:"文件预览"},{default:(0,c.k6)((({row:e})=>[e.metadata?.FileType?.includes("image")?((0,c.uX)(),(0,c.Wv)(_,{key:0,src:"/file/"+e.name+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):((0,c.uX)(),(0,c.CE)("video",{key:1,src:"/file/"+e.name+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,p))])),_:1}),(0,c.bF)(x,{formatter:y.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":y.sortByTimestamp},{default:(0,c.k6)((({row:e})=>[(0,c.eW)((0,d.v_)(y.formatTimeStamp(e.metadata.TimeStamp)),1)])),_:1},8,["formatter","sort-method"])])),_:2},1032,["data"])])])),_:1}),(0,c.bF)(x,{prop:"ip",label:"IP地址"}),(0,c.bF)(x,{prop:"count",label:"上传次数",sortable:""}),(0,c.bF)(x,{label:"允许上传"},{default:(0,c.k6)((({row:e})=>[(0,c.bF)(L,{modelValue:e.enable,"onUpdate:modelValue":t=>e.enable=t,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:t=>y.handleSwitchEnable(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data"])])])}a(4114),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);var k=a(782),y={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[]}},components:{DashboardTabs:r.A},computed:{...(0,k.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768}},methods:{async fetchWithAuth(e,t={}){this.credentials&&(t.headers={...t.headers,Authorization:`Basic ${this.credentials}`},t.credentials="include");const a=await fetch(e,t);if(401===a.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return a},dealByIP(e){let t=[],a=new Set;return e.forEach((e=>{e.metadata?.UploadIP&&a.add(e.metadata.UploadIP)})),a.forEach((a=>{let i=e.filter((e=>e.metadata?.UploadIP===a)),o=i.length,n=!this.blockipList.includes(a);t.push({ip:a,count:o,data:i,enable:n})})),t},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,t){return new Date(e.metadata.TimeStamp)-new Date(t.metadata.TimeStamp)},async handleSwitchEnable(e){const t=e.ip,a=e.enable;a?(this.blockipList=this.blockipList.filter((e=>e!==t)),await this.fetchWithAuth("/api/manage/cusConfig/whiteip",{method:"POST",body:t})):(this.blockipList.push(t),await this.fetchWithAuth("/api/manage/cusConfig/blockip",{method:"POST",body:t}))}},mounted(){this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)return this.showLogoutButton=!0,this.fetchWithAuth("/api/manage/list",{method:"GET"});if("Not using basic auth."==e)return this.fetchWithAuth("/api/manage/list",{method:"GET"});throw new Error("Unauthorized")})).then((e=>e.json())).then((async e=>{const t=await this.fetchWithAuth("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await t.text()).split(","),this.tableData=e,this.dealedData=this.dealByIP(e)})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")}))}},v=a(1241);const w=(0,v.A)(y,[["render",g],["__scopeId","data-v-47c9644c"]]);var C=w},8050:function(e,t,a){a(5331)},8736:function(e,t,a){a(5331)},3597:function(e,t,a){a(5331)},8830:function(e,t,a){a(5331)},6055:function(e,t,a){a(5331),a(9648),a(8050),a(9104),a(5970)},7128:function(e,t,a){a(5331),a(4318)},8450:function(e,t,a){a(5331)},9104:function(e,t,a){a(5331)},5970:function(e,t,a){a(5331)},456:function(e,t,a){a(5331)},8785:function(e,t,a){a(5331)},213:function(e,t,a){a(5331),a(9104)}}]);
//# sourceMappingURL=79.ca9778c1.js.map
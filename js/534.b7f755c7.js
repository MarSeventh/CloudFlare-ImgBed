"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[534],{8534:function(e,a,t){t.r(a),t.d(a,{default:function(){return J}});var l=t(9114),i=(t(5331),t(694),t(2006)),n=(t(8642),t(3003),t(6810)),s=(t(4396),t(4885),t(7377)),o=(t(5616),t(753)),d=(t(415),t(3565),t(4275)),r=(t(1008),t(7410),t(4880)),c=(t(10),t(4968),t(7815)),m=(t(5534),t(683)),h=(t(5385),t(47)),u=(t(9648),t(7009)),b=(t(8450),t(850)),p=(t(8736),t(7128),t(1450)),g=(t(213),t(9017)),f=(t(6055),t(8830),t(3597),t(2105)),k=(t(9092),t(3496)),F=t(6768),U=t(4232),w=t(5130);const C={class:"container"},T={class:"header-content"},y={class:"search-card"},$={class:"stats"},v={class:"actions"},D={class:"el-dropdown-link"},x={class:"el-dropdown-link"},_={class:"el-dropdown-link"},L={class:"content"},W={class:"file-short-info"},E={key:0,class:"success-tag"},S={key:1,class:"fail-tag"},V={key:2,class:"success-tag"},I=["src"],B={key:2,class:"file-preview"},P={class:"image-overlay"},z={class:"overlay-buttons"},A={class:"file-info"},N={class:"pagination-container"},j={class:"detail-actions"},X=["src"],q={style:{"font-size":"medium","font-weight":"bold"}},O={class:"dialog-action"};function G(e,a,t,G,M,R){const Q=k.A,Z=f.WK,H=(0,F.g2)("font-awesome-icon"),K=g.c6,J=g.Iy,Y=g.dW,ee=p.R7,ae=r.bZ,te=b.dI,le=u.Zq,ie=h.S2,ne=m.Ik,se=c.aQ,oe=r.ZO,de=r.lX,re=d.v$,ce=d.q,me=o.MF,he=o.TS,ue=s.kZ,be=n.ll,pe=n.MQ,ge=i.xE,fe=i.US,ke=l.L;return(0,F.uX)(),(0,F.CE)("div",C,[(0,F.bF)(de,null,{default:(0,F.k6)((()=>[(0,F.bF)(ae,null,{default:(0,F.k6)((()=>[(0,F.Lk)("div",T,[(0,F.bF)(Q,{activeTab:"dashboard"}),(0,F.Lk)("div",y,[(0,F.bF)(Z,{modelValue:M.search,"onUpdate:modelValue":a[0]||(a[0]=e=>M.search=e),size:"mini",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),(0,F.Lk)("span",$,[(0,F.bF)(H,{icon:"database",class:"fa-database"}),(0,F.eW)(" 记录总数量: "+(0,U.v_)(M.Number),1)]),(0,F.Lk)("div",v,[(0,F.bF)(Y,{onCommand:R.sort,"hide-on-click":!1},{dropdown:(0,F.k6)((()=>[(0,F.bF)(J,null,{default:(0,F.k6)((()=>[(0,F.bF)(K,{command:"dateDesc"},{default:(0,F.k6)((()=>a[21]||(a[21]=[(0,F.eW)("按时间倒序")]))),_:1}),(0,F.bF)(K,{command:"nameAsc"},{default:(0,F.k6)((()=>a[22]||(a[22]=[(0,F.eW)("按名称升序")]))),_:1})])),_:1})])),default:(0,F.k6)((()=>[(0,F.Lk)("span",D,[(0,F.bF)(H,{icon:R.sortIcon,class:"header-icon"},null,8,["icon"])])])),_:1},8,["onCommand"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"全屏",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"fa-th",class:"header-icon",onClick:R.showFullScreen},null,8,["onClick"])])),_:1},8,["disabled"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"全选此页",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:R.selectPageIcon,class:"header-icon",onClick:R.handleSelectPage},null,8,["icon","onClick"])])),_:1},8,["disabled"]),(0,F.bF)(Y,{onCommand:R.handleBatchAction,"hide-on-click":!1,disabled:0===M.selectedFiles.length},{dropdown:(0,F.k6)((()=>[(0,F.bF)(J,null,{default:(0,F.k6)((()=>[(0,F.bF)(K,{command:"copy"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"copy",style:{"margin-right":"5px"}}),a[23]||(a[23]=(0,F.eW)(" 批量复制 "))])),_:1}),(0,F.bF)(K,{command:"delete"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"trash-alt",style:{"margin-right":"5px"}}),a[24]||(a[24]=(0,F.eW)(" 批量删除 "))])),_:1}),(0,F.bF)(K,{command:"download"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"download",style:{"margin-right":"5px"}}),a[25]||(a[25]=(0,F.eW)(" 批量下载 "))])),_:1}),(0,F.bF)(K,{command:"ban"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"ban",style:{"margin-right":"5px"}}),a[26]||(a[26]=(0,F.eW)(" 批量黑名单 "))])),_:1}),(0,F.bF)(K,{command:"white"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"user-plus",style:{"margin-right":"5px"}}),a[27]||(a[27]=(0,F.eW)(" 批量白名单 "))])),_:1})])),_:1})])),default:(0,F.k6)((()=>[(0,F.Lk)("span",x,[(0,F.bF)(H,{icon:"ellipsis-h",class:(0,U.C4)(["header-icon",{disabled:0===M.selectedFiles.length}])},null,8,["class"])])])),_:1},8,["onCommand","disabled"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"链接格式",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.Lk)("span",_,[(0,F.bF)(H,{icon:"link",class:"header-icon",onClick:a[1]||(a[1]=e=>M.showUrlDialog=!0)})])])),_:1},8,["disabled"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"sign-out-alt",class:"header-icon",onClick:R.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,F.bF)(oe,{class:"main-container"},{default:(0,F.k6)((()=>[(0,F.bo)(((0,F.uX)(),(0,F.CE)("div",L,[((0,F.uX)(!0),(0,F.CE)(F.FK,null,(0,F.pI)(R.paginatedTableData,((e,t)=>((0,F.uX)(),(0,F.Wv)(ne,{key:t,class:"img-card"},{default:(0,F.k6)((()=>[(0,F.bF)(te,{modelValue:e.selected,"onUpdate:modelValue":a=>e.selected=a},null,8,["modelValue","onUpdate:modelValue"]),(0,F.Lk)("div",W,["White"===e.metadata?.ListType?((0,F.uX)(),(0,F.CE)("div",E,(0,U.v_)(e.channelTag),1)):"Block"===e.metadata?.ListType||"adult"===e.metadata?.Label?((0,F.uX)(),(0,F.CE)("div",S,(0,U.v_)(e.channelTag),1)):((0,F.uX)(),(0,F.CE)("div",V,(0,U.v_)(e.channelTag),1))]),R.isVideo(e)?((0,F.uX)(),(0,F.CE)("video",{key:0,src:"/file/"+e.name+"?from=admin",autoplay:"",muted:"",loop:"",class:"video-preview",onClick:a[2]||(a[2]=(...e)=>R.handleVideoClick&&R.handleVideoClick(...e))},null,8,I)):R.isImage(e)?((0,F.uX)(),(0,F.Wv)(le,{key:1,"preview-teleported":!0,src:"/file/"+e.name+"?from=admin","preview-src-list":e.previewSrcList,fit:"cover",lazy:"",class:"image-preview"},null,8,["src","preview-src-list"])):((0,F.uX)(),(0,F.CE)("div",B,[(0,F.bF)(H,{icon:"file",class:"file-icon"})])),(0,F.Lk)("div",P,[(0,F.Lk)("div",z,[(0,F.bF)(ee,{disabled:R.disableTooltip,content:"复制链接",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(ie,{size:"mini",type:"primary",onClick:(0,w.D$)((a=>R.handleCopy(t,e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"copy"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"下载",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(ie,{size:"mini",type:"primary",onClick:(0,w.D$)((a=>R.handleDownload(e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"download"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"详情",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(ie,{size:"mini",type:"primary",onClick:(0,w.D$)((a=>R.openDetailDialog(t,e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"info"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,F.bF)(ee,{disabled:R.disableTooltip,content:"删除",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(ie,{size:"mini",type:"danger",onClick:(0,w.D$)((a=>R.handleDelete(t,e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"trash-alt"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"])])]),(0,F.Lk)("div",A,(0,U.v_)(e.metadata?.FileName||e.name),1)])),_:2},1024)))),128))])),[[ke,M.loading]]),(0,F.Lk)("div",N,[(0,F.bF)(se,{background:"",layout:"prev, pager, next",total:R.filteredTableData.length,"page-size":M.pageSize,"current-page":M.currentPage,onCurrentChange:R.handlePageChange},null,8,["total","page-size","current-page","onCurrentChange"]),M.currentPage===Math.ceil(R.filteredTableData.length/M.pageSize)?((0,F.uX)(),(0,F.Wv)(ie,{key:0,type:"primary",onClick:R.loadMoreData,loading:M.loading,class:"load-more"},{default:(0,F.k6)((()=>a[28]||(a[28]=[(0,F.eW)("加载更多")]))),_:1},8,["onClick","loading"])):(0,F.Q3)("",!0)])])),_:1})])),_:1}),(0,F.bF)(ue,{title:"文件详情",modelValue:M.showdetailDialog,"onUpdate:modelValue":a[15]||(a[15]=e=>M.showdetailDialog=e),width:R.dialogWidth},{default:(0,F.k6)((()=>[(0,F.Lk)("div",j,[(0,F.bF)(ie,{type:"primary",onClick:a[3]||(a[3]=e=>R.handleDownload(M.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"download",style:{"margin-right":"3px"}}),a[29]||(a[29]=(0,F.eW)(" 下载 "))])),_:1}),(0,F.bF)(ie,{type:"primary",onClick:a[4]||(a[4]=e=>R.handleBlock(M.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"ban",style:{"margin-right":"3px"}}),a[30]||(a[30]=(0,F.eW)(" 黑名单 "))])),_:1}),(0,F.bF)(ie,{type:"primary",onClick:a[5]||(a[5]=e=>R.handleWhite(M.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"user-plus",style:{"margin-right":"3px"}}),a[31]||(a[31]=(0,F.eW)(" 白名单 "))])),_:1}),(0,F.bF)(ie,{type:"danger",onClick:a[6]||(a[6]=e=>R.handleDetailDelete(M.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"trash-alt",style:{"margin-right":"3px"}}),a[32]||(a[32]=(0,F.eW)(" 删除 "))])),_:1})]),(0,F.bF)(ce,{modelValue:M.activeUrlTab,"onUpdate:modelValue":a[13]||(a[13]=e=>M.activeUrlTab=e),onTabClick:R.handleTabClick,style:{"margin-bottom":"10px"}},{default:(0,F.k6)((()=>[(0,F.bF)(re,{label:"原始链接",name:"originUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:R.allUrl.originUrl,"onUpdate:modelValue":a[7]||(a[7]=e=>R.allUrl.originUrl=e),readonly:"",onClick:R.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,F.bF)(re,{label:"Markdown",name:"mdUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:R.allUrl.mdUrl,"onUpdate:modelValue":a[8]||(a[8]=e=>R.allUrl.mdUrl=e),readonly:"",onClick:R.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,F.bF)(re,{label:"HTML",name:"htmlUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:R.allUrl.htmlUrl,"onUpdate:modelValue":a[9]||(a[9]=e=>R.allUrl.htmlUrl=e),readonly:"",onClick:R.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,F.bF)(re,{label:"BBCode",name:"bbUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:R.allUrl.bbUrl,"onUpdate:modelValue":a[10]||(a[10]=e=>R.allUrl.bbUrl=e),readonly:"",onClick:R.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),M.detailFile?.metadata?.TgFileId?((0,F.uX)(),(0,F.Wv)(re,{key:0,label:"TG File ID",name:"tgId"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:R.allUrl.tgId,"onUpdate:modelValue":a[11]||(a[11]=e=>R.allUrl.tgId=e),readonly:"",onClick:R.handleUrlClick},null,8,["modelValue","onClick"])])),_:1})):(0,F.Q3)("",!0),M.detailFile?.metadata?.S3Location?((0,F.uX)(),(0,F.Wv)(re,{key:1,label:"S3 Location",name:"s3Location"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:R.allUrl.S3Location,"onUpdate:modelValue":a[12]||(a[12]=e=>R.allUrl.S3Location=e),readonly:"",onClick:R.handleUrlClick},null,8,["modelValue","onClick"])])),_:1})):(0,F.Q3)("",!0)])),_:1},8,["modelValue","onTabClick"]),(0,F.bF)(he,{direction:"vertical",border:"",column:R.tableColumnNum},{default:(0,F.k6)((()=>[(0,F.bF)(me,{label:"文件预览",rowspan:R.tablePreviewSpan,width:300,align:"center"},{default:(0,F.k6)((()=>[R.isVideo(M.detailFile)?((0,F.uX)(),(0,F.CE)("video",{key:0,src:"/file/"+M.detailFile?.name+"?from=admin",autoplay:"",muted:"",loop:"",class:"video-preview",onClick:a[14]||(a[14]=(...e)=>R.handleVideoClick&&R.handleVideoClick(...e))},null,8,X)):R.isImage(M.detailFile)?((0,F.uX)(),(0,F.Wv)(le,{key:1,src:"/file/"+M.detailFile?.name+"?from=admin",fit:"cover",lazy:"",class:"image-preview"},null,8,["src"])):((0,F.uX)(),(0,F.Wv)(H,{key:2,icon:"file",class:"file-icon-detail"}))])),_:1},8,["rowspan"]),(0,F.bF)(me,{label:"文件名","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(M.detailFile?.metadata?.FileName||M.detailFile?.name),1)])),_:1}),(0,F.bF)(me,{label:"文件类型","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(M.detailFile?.metadata?.FileType||"未知"),1)])),_:1}),(0,F.bF)(me,{label:"文件大小(MB)","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(M.detailFile?.metadata?.FileSize||"未知"),1)])),_:1}),(0,F.bF)(me,{label:"上传时间","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(new Date(M.detailFile?.metadata?.TimeStamp).toLocaleString()||"未知"),1)])),_:1}),(0,F.bF)(me,{label:"访问状态","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(R.accessType),1)])),_:1}),(0,F.bF)(me,{label:"上传渠道","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(M.detailFile?.metadata?.Channel||"未知"),1)])),_:1}),(0,F.bF)(me,{label:"审查结果","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(M.detailFile?.metadata?.Label||"无"),1)])),_:1}),(0,F.bF)(me,{label:"上传IP","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,U.v_)(M.detailFile?.metadata?.UploadIP||"未知"),1)])),_:1})])),_:1},8,["column"])])),_:1},8,["modelValue","width"]),(0,F.bF)(ue,{title:"链接格式",modelValue:M.showUrlDialog,"onUpdate:modelValue":a[20]||(a[20]=e=>M.showUrlDialog=e),width:R.dialogWidth,"show-close":!1},{default:(0,F.k6)((()=>[a[43]||(a[43]=(0,F.Lk)("p",{style:{"font-size":"medium","font-weight":"bold"}},"默认复制链接",-1)),(0,F.bF)(pe,{modelValue:M.defaultUrlFormat,"onUpdate:modelValue":a[16]||(a[16]=e=>M.defaultUrlFormat=e)},{default:(0,F.k6)((()=>[(0,F.bF)(be,{label:"originUrl"},{default:(0,F.k6)((()=>a[33]||(a[33]=[(0,F.eW)("原始链接")]))),_:1}),(0,F.bF)(be,{label:"mdUrl"},{default:(0,F.k6)((()=>a[34]||(a[34]=[(0,F.eW)("Markdown")]))),_:1}),(0,F.bF)(be,{label:"htmlUrl"},{default:(0,F.k6)((()=>a[35]||(a[35]=[(0,F.eW)("HTML")]))),_:1}),(0,F.bF)(be,{label:"bbUrl"},{default:(0,F.k6)((()=>a[36]||(a[36]=[(0,F.eW)("BBCode")]))),_:1}),(0,F.bF)(be,{label:"tgId"},{default:(0,F.k6)((()=>a[37]||(a[37]=[(0,F.eW)("TG File ID")]))),_:1}),(0,F.bF)(be,{label:"s3Location"},{default:(0,F.k6)((()=>a[38]||(a[38]=[(0,F.eW)("S3链接")]))),_:1})])),_:1},8,["modelValue"]),(0,F.Lk)("p",q,[a[39]||(a[39]=(0,F.eW)("自定义链接 ")),(0,F.bF)(ee,{content:"默认链接为https://your.domain/file/xxx.jpg <br> 如果启用自定义链接格式，只保留xxx.jpg部分，其他部分请自行输入",placement:"top","raw-content":""},{default:(0,F.k6)((()=>[(0,F.bF)(H,{icon:"question-circle",class:"question-icon",size:"me"})])),_:1})]),(0,F.bF)(fe,{"label-width":"25%"},{default:(0,F.k6)((()=>[(0,F.bF)(ge,{label:"启用自定义"},{default:(0,F.k6)((()=>[(0,F.bF)(pe,{modelValue:M.useCustomUrl,"onUpdate:modelValue":a[17]||(a[17]=e=>M.useCustomUrl=e)},{default:(0,F.k6)((()=>[(0,F.bF)(be,{value:"true"},{default:(0,F.k6)((()=>a[40]||(a[40]=[(0,F.eW)("是")]))),_:1}),(0,F.bF)(be,{value:"false"},{default:(0,F.k6)((()=>a[41]||(a[41]=[(0,F.eW)("否")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),"true"===M.useCustomUrl?((0,F.uX)(),(0,F.Wv)(ge,{key:0,label:"自定义前缀"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{modelValue:M.customUrlPrefix,"onUpdate:modelValue":a[18]||(a[18]=e=>M.customUrlPrefix=e),placeholder:"请输入自定义链接前缀"},null,8,["modelValue"])])),_:1})):(0,F.Q3)("",!0)])),_:1}),(0,F.Lk)("div",O,[(0,F.bF)(ie,{type:"primary",onClick:a[19]||(a[19]=e=>M.showUrlDialog=!1)},{default:(0,F.k6)((()=>a[42]||(a[42]=[(0,F.eW)("确定")]))),_:1})])])),_:1},8,["modelValue","width"])])}t(4114),t(4603),t(7566),t(8721);var M=t(782),R=t(4813),Q=t.n(R),Z={data(){return{Number:0,showLogoutButton:!1,tableData:[],search:"",currentPage:1,pageSize:15,selectedFiles:[],sortOption:"dateDesc",isUploading:!1,showdetailDialog:!1,detailFile:null,activeUrlTab:"originUrl",defaultUrlFormat:"originUrl",showUrlDialog:!1,useCustomUrl:"false",customUrlPrefix:"",loading:!1}},components:{DashboardTabs:k.A},computed:{...(0,M.L8)(["credentials","adminUrlSettings","userConfig"]),filteredTableData(){return this.tableData.filter((e=>!this.search||e.name.toLowerCase().includes(this.search.toLowerCase())||e.metadata?.FileName?.toLowerCase().includes(this.search.toLowerCase())))},paginatedTableData(){const e=this.sortData(this.filteredTableData),a=(this.currentPage-1)*this.pageSize,t=a+this.pageSize;let l=e.slice(a,t);const i=l.filter((e=>!e.metadata?.FileType?.includes("video"))).map((e=>`/file/${e.name}?from=admin`));return l.forEach((e=>{e.metadata?.FileType?.includes("video")||(e.previewSrcList=i.slice(i.indexOf(`/file/${e.name}?from=admin`)).concat(i.slice(0,i.indexOf(`/file/${e.name}?from=admin`))))})),l.forEach((e=>{"TelegramNew"===e.metadata?.Channel?e.channelTag="TG":"CloudflareR2"===e.metadata?.Channel?e.channelTag="R2":"S3"===e.metadata?.Channel?e.channelTag="S3":"External"===e.metadata?.Channel?e.channelTag="外链":e.channelTag="未知"})),l},sortIcon(){return"dateDesc"===this.sortOption?"sort-amount-down":"sort-alpha-up"},dialogWidth(){return window.innerWidth>768?"50%":"90%"},accessType(){return"White"===this.detailFile?.metadata?.ListType?"正常":"Block"===this.detailFile?.metadata?.ListType||"adult"===this.detailFile?.metadata?.Label?"受限":"正常"},allUrl(){return"External"===this.detailFile?.metadata?.Channel?{originUrl:`${this.detailFile?.metadata?.ExternalLink}`,mdUrl:`![${this.detailFile?.metadata?.FileName||this.detailFile?.name}](${this.detailFile?.metadata?.ExternalLink})`,htmlUrl:`<img src="${this.detailFile?.metadata?.ExternalLink}" alt="${this.detailFile?.metadata?.FileName||this.detailFile?.name}" width=100%>`,bbUrl:`[img]${this.detailFile?.metadata?.ExternalLink}[/img]`,tgId:this.detailFile?.metadata?.TgFileId||"未知",S3Location:this.detailFile?.metadata?.S3Location||"未知"}:{originUrl:`${this.rootUrl}${this.detailFile?.name}`,mdUrl:`![${this.detailFile?.metadata?.FileName||this.detailFile?.name}](${this.rootUrl}${this.detailFile?.name})`,htmlUrl:`<img src="${this.rootUrl}${this.detailFile?.name}" alt="${this.detailFile?.metadata?.FileName||this.detailFile?.name}" width=100%>`,bbUrl:`[img]${this.rootUrl}${this.detailFile?.name}[/img]`,tgId:this.detailFile?.metadata?.TgFileId||"未知",S3Location:this.detailFile?.metadata?.S3Location||"未知"}},tableColumnNum(){return window.innerWidth>768?3:1},tablePreviewSpan(){return window.innerWidth>768?2:1},disableTooltip(){return window.innerWidth<768},selectPage(){return this.paginatedTableData.every((e=>e.selected))},selectedPageFiles(){return this.paginatedTableData.some((e=>e.selected))},selectPageIcon(){return this.selectPage?"check-square":this.selectedPageFiles?"minus-square":"square"},rootUrl(){return"true"===this.useCustomUrl?this.customUrlPrefix:this.userConfig?.urlPrefix||`${document.location.origin}/file/`}},watch:{tableData:{handler(e){this.selectedFiles=this.selectedFiles.concat(e.filter((e=>e.selected&&!this.selectedFiles.includes(e)))),this.selectedFiles=this.selectedFiles.filter((e=>e.selected))},deep:!0},sortOption(e){localStorage.setItem("sortOption",e)},defaultUrlFormat(e){localStorage.setItem("defaultUrlFormat",e)},showdetailDialog(e){e&&(this.activeUrlTab=this.defaultUrlFormat||"originUrl")},customUrlPrefix(e){this.$store.commit("setAdminUrlSettings",{key:"customUrlPrefix",value:e})},useCustomUrl(e){this.$store.commit("setAdminUrlSettings",{key:"useCustomUrl",value:e})}},methods:{showFullScreen(){this.$router.push("/fallImg")},handleDownload(e){const a=document.createElement("a");a.href=`/file/${e}?from=admin`,a.download=e,a.click()},openDetailDialog(e,a){this.detailFile=this.paginatedTableData[e],this.showdetailDialog=!0},handleTabClick(e){this.activeUrlTab=e.props.name},handleUrlClick(e){navigator.clipboard.writeText(e.target.value).then((()=>{this.$message({type:"success",message:"复制成功"})})).catch((()=>{this.$message({type:"error",message:"复制失败"})}))},handleDetailDelete(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/delete/${e}`,{method:"GET"}).then((a=>{if(!a.ok)return Promise.reject("请求失败");{const a=this.tableData.findIndex((a=>a.name===e));-1!==a&&this.tableData.splice(a,1)}})).then((()=>{this.updateStats(-1,!1),this.$message.success("删除成功!"),this.showdetailDialog=!1})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBlock(e){this.$confirm("此操作将把该文件加入黑名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/block/${e}`,{method:"GET"}).then((a=>{if(!a.ok)return Promise.reject("请求失败");{const a=this.tableData.findIndex((a=>a.name===e));-1!==a&&(this.tableData[a].metadata.ListType="Block")}})).then((()=>{this.$message.success("加入黑名单成功!")})).catch((()=>this.$message.error("加入黑名单失败，请检查网络连接")))})).catch((()=>console.log("已取消加入黑名单")))},handleWhite(e){this.$confirm("此操作将把该文件加入白名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/white/${e}`,{method:"GET"}).then((a=>{if(!a.ok)return Promise.reject("请求失败");{const a=this.tableData.findIndex((a=>a.name===e));-1!==a&&(this.tableData[a].metadata.ListType="White")}})).then((()=>{this.$message.success("加入白名单成功!")})).catch((()=>this.$message.error("加入白名单失败，请检查网络连接")))})).catch((()=>console.log("已取消加入白名单")))},async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},handleDelete(e,a){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/delete/${a}`,{method:"GET"}).then((e=>{if(!e.ok)return Promise.reject("请求失败");{const e=this.tableData.findIndex((e=>e.name===a));-1!==e&&this.tableData.splice(e,1)}})).then((()=>{this.updateStats(-1,!1),this.$message.success("删除成功!")})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBatchDelete(){this.$confirm("此操作将永久删除选中的文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>this.fetchWithAuth(`/api/manage/delete/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{let a=0;e.forEach(((e,t)=>{if(e.ok){a++;const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[t].name));-1!==e&&this.tableData.splice(e,1)}})),this.selectedFiles=[],this.updateStats(-a,!1),this.$message.success("批量删除成功!")})).catch((()=>this.$message.error("批量删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量删除")))},handleBatchCopy(){let e="";switch(this.defaultUrlFormat){case"originUrl":e=this.selectedFiles.map((e=>"External"===e.metadata?.Channel?e.metadata?.ExternalLink:`${this.rootUrl}${e.name}`)).join("\n");break;case"mdUrl":e=this.selectedFiles.map((e=>"External"===e.metadata?.Channel?`![${e.metadata?.FileName||e.name}](${e.metadata?.ExternalLink})`:`![${e.metadata?.FileName||e.name}](${this.rootUrl}${e.name})`)).join("\n");break;case"htmlUrl":e=this.selectedFiles.map((e=>"External"===e.metadata?.Channel?`<img src="${e.metadata?.ExternalLink}" alt="${e.metadata?.FileName||e.name}" width=100%>`:`<img src="${this.rootUrl}${e.name}" alt="${e.metadata?.FileName||e.name}" width=100%>`)).join("\n");break;case"bbUrl":e=this.selectedFiles.map((e=>"External"===e.metadata?.Channel?`[img]${e.metadata?.ExternalLink}[/img]`:`[img]${this.rootUrl}${e.name}[/img]`)).join("\n");break;case"tgId":e=this.selectedFiles.map((e=>e.metadata?.TgFileId||"none")).join("\n");break;case"s3Location":e=this.selectedFiles.map((e=>e.metadata?.S3Location||"none")).join("\n");break}const a=e;navigator.clipboard?navigator.clipboard.writeText(a).then((()=>this.$message.success("批量复制链接成功~"))):this.copyToClipboardFallback(a)},copyToClipboardFallback(e){const a=document.createElement("textarea");document.body.appendChild(a),a.style.position="fixed",a.style.clip="rect(0 0 0 0)",a.style.top="10px",a.value=e,a.select(),document.execCommand("copy"),document.body.removeChild(a),this.$message.success("批量复制链接成功~")},handleCopy(e,a){let t="";if("External"===this.paginatedTableData[e].metadata?.Channel)switch(this.defaultUrlFormat){case"originUrl":t=this.paginatedTableData[e].metadata?.ExternalLink;break;case"mdUrl":t=`![${this.paginatedTableData[e].metadata?.FileName||a}](${this.paginatedTableData[e].metadata?.ExternalLink})`;break;case"htmlUrl":t=`<img src="${this.paginatedTableData[e].metadata?.ExternalLink}" alt="${this.paginatedTableData[e].metadata?.FileName||a}" width=100%>`;break;case"bbUrl":t=`[img]${this.paginatedTableData[e].metadata?.ExternalLink}[/img]`;break;case"tgId":t=this.paginatedTableData[e].metadata?.TgFileId||"none";break;case"s3Location":t=this.paginatedTableData[e].metadata?.S3Location||"none";break}else switch(this.defaultUrlFormat){case"originUrl":t=`${this.rootUrl}${a}`;break;case"mdUrl":t=`![${this.paginatedTableData[e].metadata?.FileName||a}](${this.rootUrl}${a})`;break;case"htmlUrl":t=`<img src="${this.rootUrl}${a}" alt="${this.paginatedTableData[e].metadata?.FileName||a}" width=100%>`;break;case"bbUrl":t=`[img]${this.rootUrl}${a}[/img]`;break;case"tgId":t=this.paginatedTableData[e].metadata?.TgFileId||"none";break;case"s3Location":t=this.paginatedTableData[e].metadata?.S3Location||"none";break}navigator.clipboard?navigator.clipboard.writeText(t).then((()=>this.$message.success("复制文件链接成功~"))):this.copyToClipboardFallback(t)},loadMoreData(){this.loading=!0;const e=this.tableData.length;this.fetchWithAuth(`/api/manage/list?start=${e}&count=60`,{method:"GET"}).then((e=>e.json())).then((e=>{if(0===e.length)return void this.$message.info("没有更多数据了");e.map((e=>(e.selected=!1,e)));this.tableData=this.tableData.concat(e),this.sortData(this.tableData)})).catch((()=>this.$message.error("加载更多数据失败，请检查网络连接"))).finally((()=>this.loading=!1))},updateStats(e,a=!1){a?this.fetchWithAuth("/api/manage/list?count=-1&sum=true",{method:"GET"}).then((e=>e.json())).then((e=>{this.Number=e.sum})).catch((()=>this.$message.error("更新统计信息失败，请检查网络连接"))):this.Number+=e},sort(e){this.sortOption=e},sortData(e){return"nameAsc"===this.sortOption?e.sort(((e,a)=>e.name.localeCompare(a.name))):e.sort(((e,a)=>a.metadata.TimeStamp-e.metadata.TimeStamp))},handleVideoClick(e){const a=e.target;a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen()},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},handleSelectPage(){this.selectPage?this.paginatedTableData.forEach((e=>e.selected=!1)):this.paginatedTableData.forEach((e=>e.selected=!0))},handleBatchAction(e){"copy"===e?this.handleBatchCopy():"delete"===e?this.handleBatchDelete():"download"===e?this.handleBatchDownload():"ban"===e?this.handleBatchBlock():"white"===e&&this.handleBatchWhite()},handleBatchBlock(){this.$confirm("此操作将把选中的文件加入黑名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>this.fetchWithAuth(`/api/manage/block/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{e.forEach(((e,a)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[a].name));-1!==e&&(this.tableData[e].metadata.ListType="Block")}})),this.$message.success("批量加入黑名单成功!")})).catch((()=>this.$message.error("批量加入黑名单失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量加入黑名单")))},handleBatchWhite(){this.$confirm("此操作将把选中的文件加入白名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>this.fetchWithAuth(`/api/manage/white/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{e.forEach(((e,a)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[a].name));-1!==e&&(this.tableData[e].metadata.ListType="White")}})),this.$message.success("批量加入白名单成功!")})).catch((()=>this.$message.error("批量加入白名单失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量加入白名单")))},handleBatchDownload(){const e=new(Q()),a=e.folder("files"),t={},l=this.selectedFiles.map((e=>fetch(`/file/${e.name}?from=admin`).then((e=>e.blob())).then((l=>{let i=e.metadata?.FileName||e.name;if(t[i]){const a=i.substring(i.lastIndexOf(".")),l=i.substring(0,i.lastIndexOf("."));i=`${l}(${t[i]})${a}`,t[e.name]++}else t[i]=1;a.file(i,l)}))));Promise.all(l).then((()=>e.generateAsync({type:"blob"}))).then((e=>{const a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="files.zip",a.click()}))},isVideo(e){let a=e.metadata?.FileType?.includes("video")||e.metadata?.FileType?.includes("audio");if(!a){const t=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","rmvb","3gp","mpg","mpeg","m4v","f4v","rm","asf","dat","ts","vob","swf","divx","xvid","m2ts","mts","m2v","3g2","3gp2","3gpp","3gpp2","mpe","m1v","mpv","mpv2","mp2v","m2t","m2ts","m2v","m4b","m4p","m4v","m4r"],l=e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase();a=t.includes(l)}return a},isImage(e){let a=e.metadata?.FileType?.includes("image");if(!a){const t=["jpg","jpeg","png","gif","bmp","webp","svg","ico","tiff","tif","psd","ai","eps","raw","cr2","nef","orf","sr2","dng","arw","rw2","raf","pef","x3f","srf","erf","mrw","nrw","kdc","dcr","mef","mos","crw","raf","rwl","srw","3fr","fff","iiq","qtk","bay","k25","kdc","dcs","drf","dng","erf","kdc","mdc","mef","mos","mrw","nef","nrw","orf","pef","ptx","pxn","r3d","raf","raw","rwl","rw2","rwz","sr2","srf","x3f"],l=e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase();a=t.includes(l)}return a},handlePageChange(e){this.currentPage=e,this.currentPage===Math.ceil(this.filteredTableData.length/this.pageSize)&&this.loadMoreData()}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)return this.showLogoutButton=!0,this.fetchWithAuth("/api/manage/list?count=60",{method:"GET"});if("Not using basic auth."==e)return this.fetchWithAuth("/api/manage/list?count=60",{method:"GET"});throw new Error("Unauthorized")})).then((e=>e.json())).then((e=>{this.tableData=e.map((e=>({...e,selected:!1}))),this.updateStats(0,!0);const a=localStorage.getItem("sortOption");a&&(this.sortOption=a);const t=localStorage.getItem("defaultUrlFormat");t&&(this.defaultUrlFormat=t),this.sortData(this.tableData)})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")})).finally((()=>{this.loading=!1})),this.customUrlPrefix=this.adminUrlSettings.customUrlPrefix,this.useCustomUrl=this.adminUrlSettings.useCustomUrl}},H=t(1241);const K=(0,H.A)(Z,[["render",G],["__scopeId","data-v-51498335"]]);var J=K}}]);
//# sourceMappingURL=534.b7f755c7.js.map
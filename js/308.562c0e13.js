"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[308],{1308:function(e,a,t){t.r(a),t.d(a,{default:function(){return K}});var l=t(9114),i=(t(5331),t(694),t(2006)),s=(t(8642),t(3003),t(6810)),o=(t(4396),t(4885),t(7377)),n=(t(5616),t(753)),d=(t(415),t(3565),t(4275)),r=(t(1008),t(7410),t(4880)),c=(t(10),t(4968),t(7815)),h=(t(5534),t(683)),m=(t(5385),t(47)),u=(t(9648),t(7009)),b=(t(8450),t(850)),p=(t(8736),t(7128),t(1450)),g=(t(213),t(9017)),f=(t(6055),t(8830),t(3597),t(2105)),k=(t(9092),t(3496)),F=t(6768),w=t(4232),C=t(5130);const y={class:"container"},U={class:"header-content"},v={class:"search-card"},T={class:"stats"},D={class:"actions"},$={class:"el-dropdown-link"},_={class:"el-dropdown-link"},W={class:"el-dropdown-link"},S={class:"file-short-info"},x={key:0,class:"success-tag"},L={key:1,class:"fail-tag"},V={key:2,class:"success-tag"},I=["src"],B={key:2,class:"file-preview"},P={class:"overlay-buttons"},z={class:"pagination-container"},E={key:0},N={ref:"observer",class:"observer"},j={class:"detail-actions"},A=["src"],O={style:{"font-size":"medium","font-weight":"bold"}},X={class:"dialog-action"};function q(e,a,t,q,R,G){const M=k.A,Q=f.WK,Z=(0,F.g2)("font-awesome-icon"),H=g.c6,K=g.Iy,J=g.dW,Y=p.R7,ee=r.bZ,ae=b.dI,te=u.Zq,le=m.S2,ie=h.Ik,se=c.aQ,oe=r.ZO,ne=r.lX,de=d.v$,re=d.q,ce=n.MF,he=n.TS,me=o.kZ,ue=s.ll,be=s.MQ,pe=i.xE,ge=i.US,fe=l.L;return(0,F.uX)(),(0,F.CE)("div",y,[(0,F.bF)(ne,null,{default:(0,F.k6)((()=>[(0,F.bF)(ee,null,{default:(0,F.k6)((()=>[(0,F.Lk)("div",U,[(0,F.bF)(M,{activeTab:"dashboard"}),(0,F.Lk)("div",v,[(0,F.bF)(Q,{modelValue:R.search,"onUpdate:modelValue":a[0]||(a[0]=e=>R.search=e),size:"mini",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),(0,F.Lk)("span",T,[(0,F.bF)(Z,{icon:"database",class:"fa-database"}),(0,F.eW)(" 记录总数量: "+(0,w.v_)(R.Number),1)]),(0,F.Lk)("div",D,[(0,F.bF)(J,{onCommand:G.sort,"hide-on-click":!1},{dropdown:(0,F.k6)((()=>[(0,F.bF)(K,null,{default:(0,F.k6)((()=>[(0,F.bF)(H,{command:"dateDesc"},{default:(0,F.k6)((()=>a[21]||(a[21]=[(0,F.eW)("按时间倒序")]))),_:1}),(0,F.bF)(H,{command:"nameAsc"},{default:(0,F.k6)((()=>a[22]||(a[22]=[(0,F.eW)("按名称升序")]))),_:1})])),_:1})])),default:(0,F.k6)((()=>[(0,F.Lk)("span",$,[(0,F.bF)(Z,{icon:G.sortIcon,class:"header-icon"},null,8,["icon"])])])),_:1},8,["onCommand"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"全屏",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"fa-th",class:"header-icon",onClick:G.showFullScreen},null,8,["onClick"])])),_:1},8,["disabled"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"全选此页",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:G.selectPageIcon,class:"header-icon",onClick:G.handleSelectPage},null,8,["icon","onClick"])])),_:1},8,["disabled"]),(0,F.bF)(J,{onCommand:G.handleBatchAction,"hide-on-click":!1,disabled:0===R.selectedFiles.length},{dropdown:(0,F.k6)((()=>[(0,F.bF)(K,null,{default:(0,F.k6)((()=>[(0,F.bF)(H,{command:"copy"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"copy",style:{"margin-right":"5px"}}),a[23]||(a[23]=(0,F.eW)(" 批量复制 "))])),_:1}),(0,F.bF)(H,{command:"delete"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"trash-alt",style:{"margin-right":"5px"}}),a[24]||(a[24]=(0,F.eW)(" 批量删除 "))])),_:1}),(0,F.bF)(H,{command:"download"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"download",style:{"margin-right":"5px"}}),a[25]||(a[25]=(0,F.eW)(" 批量下载 "))])),_:1}),(0,F.bF)(H,{command:"ban"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"ban",style:{"margin-right":"5px"}}),a[26]||(a[26]=(0,F.eW)(" 批量黑名单 "))])),_:1}),(0,F.bF)(H,{command:"white"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"user-plus",style:{"margin-right":"5px"}}),a[27]||(a[27]=(0,F.eW)(" 批量白名单 "))])),_:1})])),_:1})])),default:(0,F.k6)((()=>[(0,F.Lk)("span",_,[(0,F.bF)(Z,{icon:"ellipsis-h",class:(0,w.C4)(["header-icon",{disabled:0===R.selectedFiles.length}])},null,8,["class"])])])),_:1},8,["onCommand","disabled"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"链接格式",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.Lk)("span",W,[(0,F.bF)(Z,{icon:"link",class:"header-icon",onClick:a[1]||(a[1]=e=>R.showUrlDialog=!0)})])])),_:1},8,["disabled"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"sign-out-alt",class:"header-icon",onClick:G.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,F.bF)(oe,{class:"main-container"},{default:(0,F.k6)((()=>[(0,F.bo)(((0,F.uX)(),(0,F.CE)("div",{class:(0,w.C4)({content:!R.showStyle.flowerWater,waterfall:R.showStyle.flowerWater})},[((0,F.uX)(!0),(0,F.CE)(F.FK,null,(0,F.pI)(R.paginatedTableDataCache,((e,t)=>((0,F.uX)(),(0,F.Wv)(ie,{key:t,class:(0,w.C4)({imgCard:!R.showStyle.flowerWater,autoCard:R.showStyle.flowerWater,elCardbody:R.showStyle.flowerWater})},{default:(0,F.k6)((()=>[(0,F.bo)((0,F.bF)(ae,{modelValue:e.selected,"onUpdate:modelValue":a=>e.selected=a},null,8,["modelValue","onUpdate:modelValue"]),[[C.aG,!R.showStyle.flowerWater]]),(0,F.Lk)("div",S,["White"===e.metadata?.ListType?((0,F.uX)(),(0,F.CE)("div",x,(0,w.v_)(e.channelTag),1)):"Block"===e.metadata?.ListType||"adult"===e.metadata?.Label?((0,F.uX)(),(0,F.CE)("div",L,(0,w.v_)(e.channelTag),1)):((0,F.uX)(),(0,F.CE)("div",V,(0,w.v_)(e.channelTag),1))]),G.isVideo(e)?((0,F.uX)(),(0,F.CE)("video",{key:0,src:"/file/"+e.name+"?from=admin",autoplay:"",muted:"",loop:"",class:"video-preview",onClick:a[2]||(a[2]=(...e)=>G.handleVideoClick&&G.handleVideoClick(...e))},null,8,I)):G.isImage(e)?((0,F.uX)(),(0,F.Wv)(te,{key:1,class:(0,w.C4)({imagePreview:!R.showStyle.flowerWater}),"preview-teleported":!0,src:"/file/"+e.name+"?from=admin","preview-src-list":e.previewSrcList,fit:"cover",lazy:""},null,8,["class","src","preview-src-list"])):((0,F.uX)(),(0,F.CE)("div",B,[(0,F.bF)(Z,{icon:"file",class:"file-icon"})])),(0,F.Lk)("div",{class:(0,w.C4)({imageOverlay:!R.showStyle.flowerWater,imageOverlay2:R.showStyle.flowerWater})},[(0,F.Lk)("div",P,[(0,F.bF)(Y,{disabled:G.disableTooltip,content:"复制链接",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(le,{size:"mini",type:"primary",onClick:(0,C.D$)((a=>G.handleCopy(t,e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"copy"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"下载",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(le,{size:"mini",type:"primary",onClick:(0,C.D$)((a=>G.handleDownload(e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"download"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"详情",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(le,{size:"mini",type:"primary",onClick:(0,C.D$)((a=>G.openDetailDialog(t,e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"info"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,F.bF)(Y,{disabled:G.disableTooltip,content:"删除",placement:"top"},{default:(0,F.k6)((()=>[(0,F.bF)(le,{size:"mini",type:"danger",onClick:(0,C.D$)((a=>G.handleDelete(t,e.name)),["stop"])},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"trash-alt"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"])])],2),(0,F.bo)((0,F.Lk)("div",{class:(0,w.C4)({fileInfo:!R.showStyle.flowerWater})},(0,w.v_)(e.metadata?.FileName||e.name),3),[[C.aG,!R.showStyle.flowerWater]])])),_:2},1032,["class"])))),128))],2)),[[fe,R.loading]]),(0,F.bo)((0,F.Lk)("div",z,[(0,F.bF)(se,{background:"",layout:"prev, pager, next",total:G.filteredTableData.length,"page-size":R.pageSize,"current-page":R.currentPage,onCurrentChange:G.handlePageChange},null,8,["total","page-size","current-page","onCurrentChange"]),R.currentPage===Math.ceil(G.filteredTableData.length/R.pageSize)?((0,F.uX)(),(0,F.Wv)(le,{key:0,type:"primary",onClick:G.loadMoreData,loading:R.loading,class:"load-more"},{default:(0,F.k6)((()=>a[28]||(a[28]=[(0,F.eW)("加载更多")]))),_:1},8,["onClick","loading"])):(0,F.Q3)("",!0)],512),[[C.aG,!R.showStyle.flowerWater]])])),_:1}),R.loading?((0,F.uX)(),(0,F.CE)("p",E,"加载中...")):(0,F.Q3)("",!0),(0,F.Lk)("div",N,null,512)])),_:1}),(0,F.bF)(me,{title:"文件详情",modelValue:R.showdetailDialog,"onUpdate:modelValue":a[15]||(a[15]=e=>R.showdetailDialog=e),width:G.dialogWidth},{default:(0,F.k6)((()=>[(0,F.Lk)("div",j,[(0,F.bF)(le,{type:"primary",onClick:a[3]||(a[3]=e=>G.handleDownload(R.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"download",style:{"margin-right":"3px"}}),a[29]||(a[29]=(0,F.eW)(" 下载 "))])),_:1}),(0,F.bF)(le,{type:"primary",onClick:a[4]||(a[4]=e=>G.handleBlock(R.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"ban",style:{"margin-right":"3px"}}),a[30]||(a[30]=(0,F.eW)(" 黑名单 "))])),_:1}),(0,F.bF)(le,{type:"primary",onClick:a[5]||(a[5]=e=>G.handleWhite(R.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"user-plus",style:{"margin-right":"3px"}}),a[31]||(a[31]=(0,F.eW)(" 白名单 "))])),_:1}),(0,F.bF)(le,{type:"danger",onClick:a[6]||(a[6]=e=>G.handleDetailDelete(R.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"trash-alt",style:{"margin-right":"3px"}}),a[32]||(a[32]=(0,F.eW)(" 删除 "))])),_:1})]),(0,F.bF)(re,{modelValue:R.activeUrlTab,"onUpdate:modelValue":a[13]||(a[13]=e=>R.activeUrlTab=e),onTabClick:G.handleTabClick,style:{"margin-bottom":"10px"}},{default:(0,F.k6)((()=>[(0,F.bF)(de,{label:"原始链接",name:"originUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:G.allUrl.originUrl,"onUpdate:modelValue":a[7]||(a[7]=e=>G.allUrl.originUrl=e),readonly:"",onClick:G.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,F.bF)(de,{label:"Markdown",name:"mdUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:G.allUrl.mdUrl,"onUpdate:modelValue":a[8]||(a[8]=e=>G.allUrl.mdUrl=e),readonly:"",onClick:G.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,F.bF)(de,{label:"HTML",name:"htmlUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:G.allUrl.htmlUrl,"onUpdate:modelValue":a[9]||(a[9]=e=>G.allUrl.htmlUrl=e),readonly:"",onClick:G.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,F.bF)(de,{label:"BBCode",name:"bbUrl"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:G.allUrl.bbUrl,"onUpdate:modelValue":a[10]||(a[10]=e=>G.allUrl.bbUrl=e),readonly:"",onClick:G.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),R.detailFile?.metadata?.TgFileId?((0,F.uX)(),(0,F.Wv)(de,{key:0,label:"TG File ID",name:"tgId"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:G.allUrl.tgId,"onUpdate:modelValue":a[11]||(a[11]=e=>G.allUrl.tgId=e),readonly:"",onClick:G.handleUrlClick},null,8,["modelValue","onClick"])])),_:1})):(0,F.Q3)("",!0),R.detailFile?.metadata?.S3Location?((0,F.uX)(),(0,F.Wv)(de,{key:1,label:"S3 Location",name:"s3Location"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:G.allUrl.S3Location,"onUpdate:modelValue":a[12]||(a[12]=e=>G.allUrl.S3Location=e),readonly:"",onClick:G.handleUrlClick},null,8,["modelValue","onClick"])])),_:1})):(0,F.Q3)("",!0)])),_:1},8,["modelValue","onTabClick"]),(0,F.bF)(he,{direction:"vertical",border:"",column:G.tableColumnNum},{default:(0,F.k6)((()=>[(0,F.bF)(ce,{label:"文件预览",rowspan:G.tablePreviewSpan,width:300,align:"center"},{default:(0,F.k6)((()=>[G.isVideo(R.detailFile)?((0,F.uX)(),(0,F.CE)("video",{key:0,src:"/file/"+R.detailFile?.name+"?from=admin",autoplay:"",muted:"",loop:"",class:"video-preview",onClick:a[14]||(a[14]=(...e)=>G.handleVideoClick&&G.handleVideoClick(...e))},null,8,A)):G.isImage(R.detailFile)?((0,F.uX)(),(0,F.Wv)(te,{key:1,src:"/file/"+R.detailFile?.name+"?from=admin",fit:"cover",lazy:"",class:"imagePreview"},null,8,["src"])):((0,F.uX)(),(0,F.Wv)(Z,{key:2,icon:"file",class:"file-icon-detail"}))])),_:1},8,["rowspan"]),(0,F.bF)(ce,{label:"文件名","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(R.detailFile?.metadata?.FileName||R.detailFile?.name),1)])),_:1}),(0,F.bF)(ce,{label:"文件类型","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(R.detailFile?.metadata?.FileType||"未知"),1)])),_:1}),(0,F.bF)(ce,{label:"文件大小(MB)","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(R.detailFile?.metadata?.FileSize||"未知"),1)])),_:1}),(0,F.bF)(ce,{label:"上传时间","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(new Date(R.detailFile?.metadata?.TimeStamp).toLocaleString()||"未知"),1)])),_:1}),(0,F.bF)(ce,{label:"访问状态","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(G.accessType),1)])),_:1}),(0,F.bF)(ce,{label:"上传渠道","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(R.detailFile?.metadata?.Channel||"未知"),1)])),_:1}),(0,F.bF)(ce,{label:"审查结果","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(R.detailFile?.metadata?.Label||"无"),1)])),_:1}),(0,F.bF)(ce,{label:"上传IP","class-name":"description-item"},{default:(0,F.k6)((()=>[(0,F.eW)((0,w.v_)(R.detailFile?.metadata?.UploadIP||"未知"),1)])),_:1})])),_:1},8,["column"])])),_:1},8,["modelValue","width"]),(0,F.bF)(me,{title:"链接格式",modelValue:R.showUrlDialog,"onUpdate:modelValue":a[20]||(a[20]=e=>R.showUrlDialog=e),width:G.dialogWidth,"show-close":!1},{default:(0,F.k6)((()=>[a[43]||(a[43]=(0,F.Lk)("p",{style:{"font-size":"medium","font-weight":"bold"}},"默认复制链接",-1)),(0,F.bF)(be,{modelValue:R.defaultUrlFormat,"onUpdate:modelValue":a[16]||(a[16]=e=>R.defaultUrlFormat=e)},{default:(0,F.k6)((()=>[(0,F.bF)(ue,{label:"originUrl"},{default:(0,F.k6)((()=>a[33]||(a[33]=[(0,F.eW)("原始链接")]))),_:1}),(0,F.bF)(ue,{label:"mdUrl"},{default:(0,F.k6)((()=>a[34]||(a[34]=[(0,F.eW)("Markdown")]))),_:1}),(0,F.bF)(ue,{label:"htmlUrl"},{default:(0,F.k6)((()=>a[35]||(a[35]=[(0,F.eW)("HTML")]))),_:1}),(0,F.bF)(ue,{label:"bbUrl"},{default:(0,F.k6)((()=>a[36]||(a[36]=[(0,F.eW)("BBCode")]))),_:1}),(0,F.bF)(ue,{label:"tgId"},{default:(0,F.k6)((()=>a[37]||(a[37]=[(0,F.eW)("TG File ID")]))),_:1}),(0,F.bF)(ue,{label:"s3Location"},{default:(0,F.k6)((()=>a[38]||(a[38]=[(0,F.eW)("S3链接")]))),_:1})])),_:1},8,["modelValue"]),(0,F.Lk)("p",O,[a[39]||(a[39]=(0,F.eW)("自定义链接 ")),(0,F.bF)(Y,{content:"默认链接为https://your.domain/file/xxx.jpg <br> 如果启用自定义链接格式，只保留xxx.jpg部分，其他部分请自行输入",placement:"top","raw-content":""},{default:(0,F.k6)((()=>[(0,F.bF)(Z,{icon:"question-circle",class:"question-icon",size:"me"})])),_:1})]),(0,F.bF)(ge,{"label-width":"25%"},{default:(0,F.k6)((()=>[(0,F.bF)(pe,{label:"启用自定义"},{default:(0,F.k6)((()=>[(0,F.bF)(be,{modelValue:R.useCustomUrl,"onUpdate:modelValue":a[17]||(a[17]=e=>R.useCustomUrl=e)},{default:(0,F.k6)((()=>[(0,F.bF)(ue,{value:"true"},{default:(0,F.k6)((()=>a[40]||(a[40]=[(0,F.eW)("是")]))),_:1}),(0,F.bF)(ue,{value:"false"},{default:(0,F.k6)((()=>a[41]||(a[41]=[(0,F.eW)("否")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),"true"===R.useCustomUrl?((0,F.uX)(),(0,F.Wv)(pe,{key:0,label:"自定义前缀"},{default:(0,F.k6)((()=>[(0,F.bF)(Q,{modelValue:R.customUrlPrefix,"onUpdate:modelValue":a[18]||(a[18]=e=>R.customUrlPrefix=e),placeholder:"请输入自定义链接前缀"},null,8,["modelValue"])])),_:1})):(0,F.Q3)("",!0)])),_:1}),(0,F.Lk)("div",X,[(0,F.bF)(le,{type:"primary",onClick:a[19]||(a[19]=e=>R.showUrlDialog=!1)},{default:(0,F.k6)((()=>a[42]||(a[42]=[(0,F.eW)("确定")]))),_:1})])])),_:1},8,["modelValue","width"])])}t(4114),t(4603),t(7566),t(8721);var R=t(782),G=t(4813),M=t.n(G),Q={data(){return{Number:0,showLogoutButton:!1,tableData:[],paginatedTableDataCache:[],search:"",currentPage:1,pageSize:15,selectedFiles:[],sortOption:"dateDesc",isUploading:!1,showdetailDialog:!1,detailFile:null,activeUrlTab:"originUrl",defaultUrlFormat:"originUrl",showUrlDialog:!1,useCustomUrl:"false",customUrlPrefix:"",loading:!1,showStyle:{flowerWater:!1,vertical:!1,landscape:!1}}},components:{DashboardTabs:k.A},computed:{...(0,R.L8)(["credentials","adminUrlSettings","userConfig"]),sortIcon(){return"dateDesc"===this.sortOption?"sort-amount-down":"sort-alpha-up"},dialogWidth(){return window.innerWidth>768?"50%":"90%"},accessType(){return"White"===this.detailFile?.metadata?.ListType?"正常":"Block"===this.detailFile?.metadata?.ListType||"adult"===this.detailFile?.metadata?.Label?"受限":"正常"},allUrl(){return{originUrl:`${this.rootUrl}${this.detailFile?.name}`,mdUrl:`![${this.detailFile?.metadata?.FileName||this.detailFile?.name}](${this.rootUrl}${this.detailFile?.name})`,htmlUrl:`<img src="${this.rootUrl}${this.detailFile?.name}" alt="${this.detailFile?.metadata?.FileName||this.detailFile?.name}" width=100%>`,bbUrl:`[img]${this.rootUrl}${this.detailFile?.name}[/img]`,tgId:this.detailFile?.metadata?.TgFileId||"未知",S3Location:this.detailFile?.metadata?.S3Location||"未知"}},tableColumnNum(){return window.innerWidth>768?3:1},tablePreviewSpan(){return window.innerWidth>768?2:1},disableTooltip(){return window.innerWidth<768},selectPage(){return this.paginatedTableDataCache.every((e=>e.selected))},selectedPageFiles(){return this.paginatedTableDataCache.some((e=>e.selected))},selectPageIcon(){return this.selectPage?"check-square":this.selectedPageFiles?"minus-square":"square"},rootUrl(){return"true"===this.useCustomUrl?this.customUrlPrefix:this.userConfig?.urlPrefix||`${document.location.origin}/file/`}},watch:{tableData:{handler(e){this.selectedFiles=this.selectedFiles.concat(e.filter((e=>e.selected&&!this.selectedFiles.includes(e)))),this.selectedFiles=this.selectedFiles.filter((e=>e.selected))},deep:!0},sortOption(e){localStorage.setItem("sortOption",e)},defaultUrlFormat(e){localStorage.setItem("defaultUrlFormat",e)},showdetailDialog(e){e&&(this.activeUrlTab=this.defaultUrlFormat||"originUrl")},customUrlPrefix(e){this.$store.commit("setAdminUrlSettings",{key:"customUrlPrefix",value:e})},useCustomUrl(e){this.$store.commit("setAdminUrlSettings",{key:"useCustomUrl",value:e})}},methods:{initObserver(){this.observer=new IntersectionObserver((e=>{e[0].isIntersecting&&this.loadMoreData(!1)}),{threshold:1}),this.observer.observe(this.$refs.observer)},filteredTableData(){return this.tableData.filter((e=>!this.search||e.name.toLowerCase().includes(this.search.toLowerCase())||e.metadata?.FileName?.toLowerCase().includes(this.search.toLowerCase())))},paginatedTableData(){const e=this.sortData(this.filteredTableData());e.forEach((e=>{"TelegramNew"===e.metadata?.Channel?e.channelTag="TG":"CloudflareR2"===e.metadata?.Channel?e.channelTag="R2":"S3"===e.metadata?.Channel?e.channelTag="S3":e.channelTag="未知"})),this.paginatedTableDataCache=e},handleChangeCss(){(this.showStyle.landscape||this.showStyle.vertical)&&(this.showStyle.flowerWater=!1)},handleDownload(e){const a=document.createElement("a");a.href=`/file/${e}?from=admin`,a.download=e,a.click()},openDetailDialog(e,a){this.detailFile=this.paginatedTableDataCache[e],this.showdetailDialog=!0},handleTabClick(e){this.activeUrlTab=e.props.name},handleUrlClick(e){navigator.clipboard.writeText(e.target.value).then((()=>{this.$message({type:"success",message:"复制成功"})})).catch((()=>{this.$message({type:"error",message:"复制失败"})}))},handleDetailDelete(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/delete/${e}`,{method:"GET"}).then((a=>{if(!a.ok)return Promise.reject("请求失败");{const a=this.tableData.findIndex((a=>a.name===e));-1!==a&&this.tableData.splice(a,1)}})).then((()=>{this.updateStats(-1,!1),this.$message.success("删除成功!"),this.showdetailDialog=!1})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBlock(e){this.$confirm("此操作将把该文件加入黑名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/block/${e}`,{method:"GET"}).then((a=>{if(!a.ok)return Promise.reject("请求失败");{const a=this.tableData.findIndex((a=>a.name===e));-1!==a&&(this.tableData[a].metadata.ListType="Block")}})).then((()=>{this.$message.success("加入黑名单成功!")})).catch((()=>this.$message.error("加入黑名单失败，请检查网络连接")))})).catch((()=>console.log("已取消加入黑名单")))},handleWhite(e){this.$confirm("此操作将把该文件加入白名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/white/${e}`,{method:"GET"}).then((a=>{if(!a.ok)return Promise.reject("请求失败");{const a=this.tableData.findIndex((a=>a.name===e));-1!==a&&(this.tableData[a].metadata.ListType="White")}})).then((()=>{this.$message.success("加入白名单成功!")})).catch((()=>this.$message.error("加入白名单失败，请检查网络连接")))})).catch((()=>console.log("已取消加入白名单")))},async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},handleDelete(e,a){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/delete/${a}`,{method:"GET"}).then((e=>{if(!e.ok)return Promise.reject("请求失败");{const e=this.tableData.findIndex((e=>e.name===a));-1!==e&&this.tableData.splice(e,1)}})).then((()=>{this.updateStats(-1,!1),this.$message.success("删除成功!")})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBatchDelete(){this.$confirm("此操作将永久删除选中的文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>this.fetchWithAuth(`/api/manage/delete/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{let a=0;e.forEach(((e,t)=>{if(e.ok){a++;const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[t].name));-1!==e&&this.tableData.splice(e,1)}})),this.selectedFiles=[],this.updateStats(-a,!1),this.$message.success("批量删除成功!")})).catch((()=>this.$message.error("批量删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量删除")))},handleBatchCopy(){let e="";switch(this.defaultUrlFormat){case"originUrl":e=this.selectedFiles.map((e=>`${this.rootUrl}${e.name}`)).join("\n");break;case"mdUrl":e=this.selectedFiles.map((e=>`![${e.metadata?.FileName||e.name}](${this.rootUrl}${e.name})`)).join("\n");break;case"htmlUrl":e=this.selectedFiles.map((e=>`<img src="${this.rootUrl}${e.name}" alt="${e.metadata?.FileName||e.name}" width=100%>`)).join("\n");break;case"bbUrl":e=this.selectedFiles.map((e=>`[img]${this.rootUrl}${e.name}[/img]`)).join("\n");break;case"tgId":e=this.selectedFiles.map((e=>e.metadata?.TgFileId||"none")).join("\n");break;case"s3Location":e=this.selectedFiles.map((e=>e.metadata?.S3Location||"none")).join("\n");break}const a=e;navigator.clipboard?navigator.clipboard.writeText(a).then((()=>this.$message.success("批量复制链接成功~"))):this.copyToClipboardFallback(a)},copyToClipboardFallback(e){const a=document.createElement("textarea");document.body.appendChild(a),a.style.position="fixed",a.style.clip="rect(0 0 0 0)",a.style.top="10px",a.value=e,a.select(),document.execCommand("copy"),document.body.removeChild(a),this.$message.success("批量复制链接成功~")},handleCopy(e,a){let t="";switch(this.defaultUrlFormat){case"originUrl":t=`${this.rootUrl}${a}`;break;case"mdUrl":t=`![${this.paginatedTableDataCache[e].metadata?.FileName||a}](${this.rootUrl}${a})`;break;case"htmlUrl":t=`<img src="${this.rootUrl}${a}" alt="${this.paginatedTableDataCache[e].metadata?.FileName||a}" width=100%>`;break;case"bbUrl":t=`[img]${this.rootUrl}${a}[/img]`;break;case"tgId":t=this.paginatedTableDataCache[e].metadata?.TgFileId||"none";break}navigator.clipboard?navigator.clipboard.writeText(t).then((()=>this.$message.success("复制文件链接成功~"))):this.copyToClipboardFallback(t)},loadMoreData(e=!0){this.loading=e;this.tableData.length;for(let a=0;a<15;a++)this.tableData.push({name:"pexels-josh-michaels-80899-28833005",metadata:{FileName:"pexels-josh-michaels-80899-28833005.jpg",FileType:"image/jpeg",FileSize:"0.86",UploadIP:"8.210.60.87",ListType:"None",TimeStamp:1740722159181,Label:"None",Channel:"CloudflareR2",ChannelName:"R2_env"}});this.sortData(this.tableData),console.log("loadmoreData",this.tableData.length),this.loading=!1,this.paginatedTableData()},updateStats(e,a=!1){a?this.fetchWithAuth("/api/manage/list?count=-1&sum=true",{method:"GET"}).then((e=>e.json())).then((e=>{this.Number=e.sum})).catch((()=>this.$message.error("更新统计信息失败，请检查网络连接"))):this.Number+=e},sort(e){this.sortOption=e},showType(e){this.showStyle.flowerWater=!0,this.showStyle.vertical="verticalScreen"==e,this.showStyle.landscape="landscapeScreen"==e,this.showStyle.flowerWater&&this.loadMoreData(!0)},sortData(e){return"nameAsc"===this.sortOption?e.sort(((e,a)=>e.name.localeCompare(a.name))):e.sort(((e,a)=>a.metadata.TimeStamp-e.metadata.TimeStamp))},handleVideoClick(e){const a=e.target;a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen()},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},handleSelectPage(){this.selectPage?this.paginatedTableDataCache.forEach((e=>e.selected=!1)):this.paginatedTableDataCache.forEach((e=>e.selected=!0))},showFullScreen(){this.$router.push("/fallImg")},handleBatchAction(e){"copy"===e?this.handleBatchCopy():"delete"===e?this.handleBatchDelete():"download"===e?this.handleBatchDownload():"ban"===e?this.handleBatchBlock():"white"===e&&this.handleBatchWhite()},handleBatchBlock(){this.$confirm("此操作将把选中的文件加入黑名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>this.fetchWithAuth(`/api/manage/block/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{e.forEach(((e,a)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[a].name));-1!==e&&(this.tableData[e].metadata.ListType="Block")}})),this.$message.success("批量加入黑名单成功!")})).catch((()=>this.$message.error("批量加入黑名单失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量加入黑名单")))},handleBatchWhite(){this.$confirm("此操作将把选中的文件加入白名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>this.fetchWithAuth(`/api/manage/white/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{e.forEach(((e,a)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[a].name));-1!==e&&(this.tableData[e].metadata.ListType="White")}})),this.$message.success("批量加入白名单成功!")})).catch((()=>this.$message.error("批量加入白名单失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量加入白名单")))},handleBatchDownload(){const e=new(M()),a=e.folder("files"),t={},l=this.selectedFiles.map((e=>fetch(`/file/${e.name}?from=admin`).then((e=>e.blob())).then((l=>{let i=e.metadata?.FileName||e.name;if(t[i]){const a=i.substring(i.lastIndexOf(".")),l=i.substring(0,i.lastIndexOf("."));i=`${l}(${t[i]})${a}`,t[e.name]++}else t[i]=1;a.file(i,l)}))));Promise.all(l).then((()=>e.generateAsync({type:"blob"}))).then((e=>{const a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="files.zip",a.click()}))},isVideo(e){let a=e.metadata?.FileType?.includes("video")||e.metadata?.FileType?.includes("audio");if(!a){const t=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","rmvb","3gp","mpg","mpeg","m4v","f4v","rm","asf","dat","ts","vob","swf","divx","xvid","m2ts","mts","m2v","3g2","3gp2","3gpp","3gpp2","mpe","m1v","mpv","mpv2","mp2v","m2t","m2ts","m2v","m4b","m4p","m4v","m4r"],l=e.name.substring(e.name.lastIndexOf(".")+1);a=t.includes(l)}return a},isImage(e){let a=e.metadata?.FileType?.includes("image");if(!a){const t=["jpg","jpeg","png","gif","bmp","webp","svg","ico","tiff","tif","psd","ai","eps","raw","cr2","nef","orf","sr2","dng","arw","rw2","raf","pef","x3f","srf","erf","mrw","nrw","kdc","dcr","mef","mos","crw","raf","rwl","srw","3fr","fff","iiq","qtk","bay","k25","kdc","dcs","drf","dng","erf","kdc","mdc","mef","mos","mrw","nef","nrw","orf","pef","ptx","pxn","r3d","raf","raw","rwl","rw2","rwz","sr2","srf","x3f"],l=e.name.substring(e.name.lastIndexOf(".")+1);a=t.includes(l)}return a},handlePageChange(e){this.currentPage=e,this.currentPage===Math.ceil(this.filteredTableData.length/this.pageSize)&&this.loadMoreData()}},mounted(){this.initObserver(),this.loading=!0;let e=[];for(let l=0;l<15;l++)e.push({name:"pexels-josh-michaels-80899-28833005",metadata:{FileName:"pexels-josh-michaels-80899-28833005.jpg",FileType:"image/jpeg",FileSize:"0.86",UploadIP:"8.210.60.87",ListType:"None",TimeStamp:1740722159181,Label:"None",Channel:"CloudflareR2",ChannelName:"R2_env"}});this.tableData=e.map((e=>({...e,selected:!1}))),this.updateStats(0,!0);const a=localStorage.getItem("sortOption");a&&(this.sortOption=a);const t=localStorage.getItem("defaultUrlFormat");t&&(this.defaultUrlFormat=t),this.sortData(this.tableData),this.loading=!1,this.customUrlPrefix=this.adminUrlSettings.customUrlPrefix,this.useCustomUrl=this.adminUrlSettings.useCustomUrl},beforeDestroy(){this.observer&&this.observer.disconnect()}},Z=t(1241);const H=(0,Z.A)(Q,[["render",q],["__scopeId","data-v-d83f69ea"]]);var K=H}}]);
//# sourceMappingURL=308.562c0e13.js.map